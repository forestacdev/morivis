(function(){"use strict";function Z(t,e,i,n){let r=n;const s=e+(i-e>>1);let o=i-e,h;const a=t[e],f=t[e+1],u=t[i],l=t[i+1];for(let d=e+3;d<i;d+=3){const c=gt(t[d],t[d+1],a,f,u,l);if(c>r)h=d,r=c;else if(c===r){const x=Math.abs(d-s);x<o&&(h=d,o=x)}}r>n&&(h-e>3&&Z(t,e,h,n),t[h+2]=r,i-h>3&&Z(t,h,i,n))}function gt(t,e,i,n,r,s){let o=r-i,h=s-n;if(o!==0||h!==0){const a=((t-i)*o+(e-n)*h)/(o*o+h*h);a>1?(i=r,n=s):a>0&&(i+=o*a,n+=h*a)}return o=t-i,h=e-n,o*o+h*h}function L(t,e,i,n){const r={id:t??null,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(e==="Point"||e==="MultiPoint"||e==="LineString")G(r,i);else if(e==="Polygon")G(r,i[0]);else if(e==="MultiLineString")for(const s of i)G(r,s);else if(e==="MultiPolygon")for(const s of i)G(r,s[0]);return r}function G(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function mt(t,e){const i=[];if(t.type==="FeatureCollection")for(let n=0;n<t.features.length;n++)Y(i,t.features[n],e,n);else t.type==="Feature"?Y(i,t,e):Y(i,{geometry:t},e);return i}function Y(t,e,i,n){if(!e.geometry)return;const r=e.geometry.coordinates;if(r&&r.length===0)return;const s=e.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let h=[],a=e.id;if(i.promoteId?a=e.properties[i.promoteId]:i.generateId&&(a=n||0),s==="Point")b(r,h);else if(s==="MultiPoint")for(const f of r)b(f,h);else if(s==="LineString")A(r,h,o,!1);else if(s==="MultiLineString")if(i.lineMetrics){for(const f of r)h=[],A(f,h,o,!1),t.push(L(a,"LineString",h,e.properties));return}else $(r,h,o,!1);else if(s==="Polygon")$(r,h,o,!0);else if(s==="MultiPolygon")for(const f of r){const u=[];$(f,u,o,!0),h.push(u)}else if(s==="GeometryCollection"){for(const f of e.geometry.geometries)Y(t,{id:a,geometry:f,properties:e.properties},i,n);return}else throw new Error("Input data is not a valid GeoJSON object.");t.push(L(a,s,h,e.properties))}function b(t,e){e.push(tt(t[0]),et(t[1]),0)}function A(t,e,i,n){let r,s,o=0;for(let a=0;a<t.length;a++){const f=tt(t[a][0]),u=et(t[a][1]);e.push(f,u,0),a>0&&(n?o+=(r*u-f*s)/2:o+=Math.sqrt(Math.pow(f-r,2)+Math.pow(u-s,2))),r=f,s=u}const h=e.length-3;e[2]=1,Z(e,0,h,i),e[h+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function $(t,e,i,n){for(let r=0;r<t.length;r++){const s=[];A(t[r],s,i,n),e.push(s)}}function tt(t){return t/360+.5}function et(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function V(t,e,i,n,r,s,o,h){if(i/=e,n/=e,s>=i&&o<n)return t;if(o<i||s>=n)return null;const a=[];for(const f of t){const u=f.geometry;let l=f.type;const d=r===0?f.minX:f.minY,c=r===0?f.maxX:f.maxY;if(d>=i&&c<n){a.push(f);continue}else if(c<i||d>=n)continue;let x=[];if(l==="Point"||l==="MultiPoint")Ft(u,x,i,n,r);else if(l==="LineString")it(u,x,i,n,r,!1,h.lineMetrics);else if(l==="MultiLineString")U(u,x,i,n,r,!1);else if(l==="Polygon")U(u,x,i,n,r,!0);else if(l==="MultiPolygon")for(const y of u){const w=[];U(y,w,i,n,r,!0),w.length&&x.push(w)}if(x.length){if(h.lineMetrics&&l==="LineString"){for(const y of x)a.push(L(f.id,l,y,f.tags));continue}(l==="LineString"||l==="MultiLineString")&&(x.length===1?(l="LineString",x=x[0]):l="MultiLineString"),(l==="Point"||l==="MultiPoint")&&(l=x.length===3?"Point":"MultiPoint"),a.push(L(f.id,l,x,f.tags))}}return a.length?a:null}function Ft(t,e,i,n,r){for(let s=0;s<t.length;s+=3){const o=t[s+r];o>=i&&o<=n&&B(e,t[s],t[s+1],t[s+2])}}function it(t,e,i,n,r,s,o){let h=nt(t);const a=r===0?vt:Mt;let f=t.start,u,l;for(let g=0;g<t.length-3;g+=3){const F=t[g],v=t[g+1],J=t[g+2],S=t[g+3],m=t[g+4],_=r===0?F:v,M=r===0?S:m;let z=!1;o&&(u=Math.sqrt(Math.pow(F-S,2)+Math.pow(v-m,2))),_<i?M>i&&(l=a(h,F,v,S,m,i),o&&(h.start=f+u*l)):_>n?M<n&&(l=a(h,F,v,S,m,n),o&&(h.start=f+u*l)):B(h,F,v,J),M<i&&_>=i&&(l=a(h,F,v,S,m,i),z=!0),M>n&&_<=n&&(l=a(h,F,v,S,m,n),z=!0),!s&&z&&(o&&(h.end=f+u*l),e.push(h),h=nt(t)),o&&(f+=u)}let d=t.length-3;const c=t[d],x=t[d+1],y=t[d+2],w=r===0?c:x;w>=i&&w<=n&&B(h,c,x,y),d=h.length-3,s&&d>=3&&(h[d]!==h[0]||h[d+1]!==h[1])&&B(h,h[0],h[1],h[2]),h.length&&e.push(h)}function nt(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function U(t,e,i,n,r,s){for(const o of t)it(o,e,i,n,r,s,!1)}function B(t,e,i,n){t.push(e,i,n)}function vt(t,e,i,n,r,s){const o=(s-e)/(n-e);return B(t,s,i+(r-i)*o,1),o}function Mt(t,e,i,n,r,s){const o=(s-i)/(r-i);return B(t,e+(n-e)*o,s,1),o}function Vt(t,e){const i=e.buffer/e.extent;let n=t;const r=V(t,1,-1-i,i,0,-1,2,e),s=V(t,1,1-i,2+i,0,-1,2,e);return(r||s)&&(n=V(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=rt(r,1).concat(n)),s&&(n=n.concat(rt(s,-1)))),n}function rt(t,e){const i=[];for(let n=0;n<t.length;n++){const r=t[n],s=r.type;let o;if(s==="Point"||s==="MultiPoint"||s==="LineString")o=R(r.geometry,e);else if(s==="MultiLineString"||s==="Polygon"){o=[];for(const h of r.geometry)o.push(R(h,e))}else if(s==="MultiPolygon"){o=[];for(const h of r.geometry){const a=[];for(const f of h)a.push(R(f,e));o.push(a)}}i.push(L(r.id,s,o,r.tags))}return i}function R(t,e){const i=[];i.size=t.size,t.start!==void 0&&(i.start=t.start,i.end=t.end);for(let n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function st(t,e){if(t.transformed)return t;const i=1<<t.z,n=t.x,r=t.y;for(const s of t.features){const o=s.geometry,h=s.type;if(s.geometry=[],h===1)for(let a=0;a<o.length;a+=2)s.geometry.push(ot(o[a],o[a+1],e,i,n,r));else for(let a=0;a<o.length;a++){const f=[];for(let u=0;u<o[a].length;u+=2)f.push(ot(o[a][u],o[a][u+1],e,i,n,r));s.geometry.push(f)}}return t.transformed=!0,t}function ot(t,e,i,n,r,s){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-s))]}function Pt(t,e,i,n,r){const s=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const h of t)St(o,h,s,r);return o}function St(t,e,i,n){const r=e.geometry,s=e.type,o=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),s==="Point"||s==="MultiPoint")for(let h=0;h<r.length;h+=3)o.push(r[h],r[h+1]),t.numPoints++,t.numSimplified++;else if(s==="LineString")W(o,r,t,i,!1,!1);else if(s==="MultiLineString"||s==="Polygon")for(let h=0;h<r.length;h++)W(o,r[h],t,i,s==="Polygon",h===0);else if(s==="MultiPolygon")for(let h=0;h<r.length;h++){const a=r[h];for(let f=0;f<a.length;f++)W(o,a[f],t,i,!0,f===0)}if(o.length){let h=e.tags||null;if(s==="LineString"&&n.lineMetrics){h={};for(const f in e.tags)h[f]=e.tags[f];h.mapbox_clip_start=r.start/r.size,h.mapbox_clip_end=r.end/r.size}const a={geometry:o,type:s==="Polygon"||s==="MultiPolygon"?3:s==="LineString"||s==="MultiLineString"?2:1,tags:h};e.id!==null&&(a.id=e.id),t.features.push(a)}}function W(t,e,i,n,r,s){const o=n*n;if(n>0&&e.size<(r?o:n)){i.numPoints+=e.length/3;return}const h=[];for(let a=0;a<e.length;a+=3)(n===0||e[a+2]>o)&&(i.numSimplified++,h.push(e[a],e[a+1])),i.numPoints++;r&&_t(h,s),t.push(h)}function _t(t,e){let i=0;for(let n=0,r=t.length,s=r-2;n<r;s=n,n+=2)i+=(t[n]-t[s])*(t[n+1]+t[s+1]);if(i>0===e)for(let n=0,r=t.length;n<r/2;n+=2){const s=t[n],o=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=s,t[r-1-n]=o}}const Bt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Tt{constructor(e,i){i=this.options=Dt(Object.create(Bt),i);const n=i.debug;if(n&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=mt(e,i);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=Vt(r,i),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,i,n,r,s,o,h){const a=[e,i,n,r],f=this.options,u=f.debug;for(;a.length;){r=a.pop(),n=a.pop(),i=a.pop(),e=a.pop();const l=1<<i,d=H(i,n,r);let c=this.tiles[d];if(!c&&(u>1&&console.time("creation"),c=this.tiles[d]=Pt(e,i,n,r,f),this.tileCoords.push({z:i,x:n,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,n,r,c.numFeatures,c.numPoints,c.numSimplified),console.timeEnd("creation"));const M=`z${i}`;this.stats[M]=(this.stats[M]||0)+1,this.total++}if(c.source=e,s==null){if(i===f.indexMaxZoom||c.numPoints<=f.indexMaxPoints)continue}else{if(i===f.maxZoom||i===s)continue;if(s!=null){const M=s-i;if(n!==o>>M||r!==h>>M)continue}}if(c.source=null,e.length===0)continue;u>1&&console.time("clipping");const x=.5*f.buffer/f.extent,y=.5-x,w=.5+x,g=1+x;let F=null,v=null,J=null,S=null,m=V(e,l,n-x,n+w,0,c.minX,c.maxX,f),_=V(e,l,n+y,n+g,0,c.minX,c.maxX,f);e=null,m&&(F=V(m,l,r-x,r+w,1,c.minY,c.maxY,f),v=V(m,l,r+y,r+g,1,c.minY,c.maxY,f),m=null),_&&(J=V(_,l,r-x,r+w,1,c.minY,c.maxY,f),S=V(_,l,r+y,r+g,1,c.minY,c.maxY,f),_=null),u>1&&console.timeEnd("clipping"),a.push(F||[],i+1,n*2,r*2),a.push(v||[],i+1,n*2,r*2+1),a.push(J||[],i+1,n*2+1,r*2),a.push(S||[],i+1,n*2+1,r*2+1)}}getTile(e,i,n){e=+e,i=+i,n=+n;const r=this.options,{extent:s,debug:o}=r;if(e<0||e>24)return null;const h=1<<e;i=i+h&h-1;const a=H(e,i,n);if(this.tiles[a])return st(this.tiles[a],s);o>1&&console.log("drilling down to z%d-%d-%d",e,i,n);let f=e,u=i,l=n,d;for(;!d&&f>0;)f--,u=u>>1,l=l>>1,d=this.tiles[H(f,u,l)];return!d||!d.source?null:(o>1&&(console.log("found parent tile z%d-%d-%d",f,u,l),console.time("drilling down")),this.splitTile(d.source,f,u,l,e,i,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?st(this.tiles[a],s):null)}}function H(t,e,i){return((1<<t)*i+e)*32+t}function Dt(t,e){for(const i in e)t[i]=e[i];return t}function It(t,e){return new Tt(t,e)}function Et(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var C={exports:{}},j={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */j.read=function(t,e,i,n,r){var s,o,h=r*8-n-1,a=(1<<h)-1,f=a>>1,u=-7,l=i?r-1:0,d=i?-1:1,c=t[e+l];for(l+=d,s=c&(1<<-u)-1,c>>=-u,u+=h;u>0;s=s*256+t[e+l],l+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+t[e+l],l+=d,u-=8);if(s===0)s=1-f;else{if(s===a)return o?NaN:(c?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-f}return(c?-1:1)*o*Math.pow(2,s-n)},j.write=function(t,e,i,n,r,s){var o,h,a,f=s*8-r-1,u=(1<<f)-1,l=u>>1,d=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,c=n?0:s-1,x=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-o))<1&&(o--,a*=2),o+l>=1?e+=d/a:e+=d*Math.pow(2,1-l),e*a>=2&&(o++,a/=2),o+l>=u?(h=0,o=u):o+l>=1?(h=(e*a-1)*Math.pow(2,r),o=o+l):(h=e*Math.pow(2,l-1)*Math.pow(2,r),o=0));r>=8;t[i+c]=h&255,c+=x,h/=256,r-=8);for(o=o<<r|h,f+=r;f>0;t[i+c]=o&255,c+=x,o/=256,f-=8);t[i+c-x]|=y*128};var Lt=p,X=j;function p(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}p.Varint=0,p.Fixed64=1,p.Bytes=2,p.Fixed32=5;var q=65536*65536,ht=1/q,Ct=12,at=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");p.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=n&7,t(r,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=N(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ut(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=N(this.buf,this.pos)+N(this.buf,this.pos+4)*q;return this.pos+=8,t},readSFixed64:function(){var t=N(this.buf,this.pos)+ut(this.buf,this.pos+4)*q;return this.pos+=8,t},readFloat:function(){var t=X.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=X.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,n;return n=e[this.pos++],i=n&127,n<128||(n=e[this.pos++],i|=(n&127)<<7,n<128)||(n=e[this.pos++],i|=(n&127)<<14,n<128)||(n=e[this.pos++],i|=(n&127)<<21,n<128)?i:(n=e[this.pos],i|=(n&15)<<28,Gt(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=Ct&&at?jt(this.buf,e,t):Ht(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==p.Bytes)return t.push(this.readVarint(e));var i=P(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==p.Bytes)return t.push(this.readSVarint());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==p.Bytes)return t.push(this.readBoolean());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==p.Bytes)return t.push(this.readFloat());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==p.Bytes)return t.push(this.readDouble());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==p.Bytes)return t.push(this.readFixed32());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==p.Bytes)return t.push(this.readSFixed32());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==p.Bytes)return t.push(this.readFixed64());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==p.Bytes)return t.push(this.readSFixed64());var e=P(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===p.Varint)for(;this.buf[this.pos++]>127;);else if(e===p.Bytes)this.pos=this.readVarint()+this.pos;else if(e===p.Fixed32)this.pos+=4;else if(e===p.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),D(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),D(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),D(this.buf,t&-1,this.pos),D(this.buf,Math.floor(t*ht),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),D(this.buf,t&-1,this.pos),D(this.buf,Math.floor(t*ht),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){Yt(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=qt(this.buf,t,this.pos);var i=this.pos-e;i>=128&&ft(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),X.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),X.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&ft(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,p.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ot,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,kt,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,At,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Jt,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Zt,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,$t,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ut,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Rt,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Wt,e)},writeBytesField:function(t,e){this.writeTag(t,p.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,p.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,p.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,p.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,p.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,p.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,p.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,p.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,p.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,p.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function Gt(t,e,i){var n=i.buf,r,s;if(s=n[i.pos++],r=(s&112)>>4,s<128||(s=n[i.pos++],r|=(s&127)<<3,s<128)||(s=n[i.pos++],r|=(s&127)<<10,s<128)||(s=n[i.pos++],r|=(s&127)<<17,s<128)||(s=n[i.pos++],r|=(s&127)<<24,s<128)||(s=n[i.pos++],r|=(s&1)<<31,s<128))return T(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function P(t){return t.type===p.Bytes?t.readVarint()+t.pos:t.pos+1}function T(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function Yt(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(i=~(-t%4294967296),n=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,n=n+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Xt(i,n,e),Nt(n,e)}function Xt(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function Nt(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function ft(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function Ot(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function kt(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Jt(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Zt(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function At(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function $t(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Ut(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Rt(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Wt(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function N(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function D(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function ut(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Ht(t,e,i){for(var n="",r=e;r<i;){var s=t[r],o=null,h=s>239?4:s>223?3:s>191?2:1;if(r+h>i)break;var a,f,u;h===1?s<128&&(o=s):h===2?(a=t[r+1],(a&192)===128&&(o=(s&31)<<6|a&63,o<=127&&(o=null))):h===3?(a=t[r+1],f=t[r+2],(a&192)===128&&(f&192)===128&&(o=(s&15)<<12|(a&63)<<6|f&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):h===4&&(a=t[r+1],f=t[r+2],u=t[r+3],(a&192)===128&&(f&192)===128&&(u&192)===128&&(o=(s&15)<<18|(a&63)<<12|(f&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,h=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),r+=h}return n}function jt(t,e,i){return at.decode(t.subarray(e,i))}function qt(t,e,i){for(var n=0,r,s;n<e.length;n++){if(r=e.charCodeAt(n),r>55295&&r<57344)if(s)if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||n+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=r;continue}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=r&63|128)}return i}var lt=I;function I(t,e){this.x=t,this.y=e}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.x+i*(this.x-e.x)-n*(this.y-e.y),s=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=r,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(t){return t instanceof I?t:Array.isArray(t)?new I(t[0],t[1]):t};var O={},Qt=lt,ct=E;function E(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(Kt,this,e)}function Kt(t,e,i){t==1?e.id=i.readVarint():t==2?zt(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function zt(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}E.types=["Unknown","Point","LineString","Polygon"],E.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,s=0,o=[],h;t.pos<e;){if(n<=0){var a=t.readVarint();i=a&7,n=a>>3}if(n--,i===1||i===2)r+=t.readSVarint(),s+=t.readSVarint(),i===1&&(h&&o.push(h),h=[]),h.push(new Qt(r,s));else if(i===7)h&&h.push(h[0].clone());else throw new Error("unknown command "+i)}return h&&o.push(h),o},E.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,s=0,o=1/0,h=-1/0,a=1/0,f=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=u&7,n=u>>3}if(n--,i===1||i===2)r+=t.readSVarint(),s+=t.readSVarint(),r<o&&(o=r),r>h&&(h=r),s<a&&(a=s),s>f&&(f=s);else if(i!==7)throw new Error("unknown command "+i)}return[o,a,h,f]},E.prototype.toGeoJSON=function(t,e,i){var n=this.extent*Math.pow(2,i),r=this.extent*t,s=this.extent*e,o=this.loadGeometry(),h=E.types[this.type],a,f;function u(c){for(var x=0;x<c.length;x++){var y=c[x],w=180-(y.y+s)*360/n;c[x]=[(y.x+r)*360/n-180,360/Math.PI*Math.atan(Math.exp(w*Math.PI/180))-90]}}switch(this.type){case 1:var l=[];for(a=0;a<o.length;a++)l[a]=o[a][0];o=l,u(o);break;case 2:for(a=0;a<o.length;a++)u(o[a]);break;case 3:for(o=bt(o),a=0;a<o.length;a++)for(f=0;f<o[a].length;f++)u(o[a][f]);break}o.length===1?o=o[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:o},properties:this.properties};return"id"in this&&(d.id=this.id),d};function bt(t){var e=t.length;if(e<=1)return[t];for(var i=[],n,r,s=0;s<e;s++){var o=te(t[s]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(n&&i.push(n),n=[t[s]]):n.push(t[s]))}return n&&i.push(n),i}function te(t){for(var e=0,i=0,n=t.length,r=n-1,s,o;i<n;r=i++)s=t[i],o=t[r],e+=(o.x-s.x)*(s.y+o.y);return e}var ee=ct,dt=xt;function xt(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ie,this,e),this.length=this._features.length}function ie(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(ne(i))}function ne(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null}return e}xt.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ee(this._pbf,e,this.extent,this._keys,this._values)};var re=dt,se=oe;function oe(t,e){this.layers=t.readFields(he,{},e)}function he(t,e,i){if(t===3){var n=new re(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}O.VectorTile=se,O.VectorTileFeature=ct,O.VectorTileLayer=dt;var ae=lt,fe=O.VectorTileFeature,ue=pt;function pt(t,e){this.options=e||{},this.features=t,this.length=t.length}pt.prototype.feature=function(t){return new k(this.features[t],this.options.extent)};function k(t,e){this.id=typeof t.id=="number"?t.id:void 0,this.type=t.type,this.rawGeometry=t.type===1?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}k.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new ae(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},k.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,s=0;s<t.length;s++)for(var o=t[s],h=0;h<o.length;h++){var a=o[h];e=Math.min(e,a.x),i=Math.max(i,a.x),n=Math.min(n,a.y),r=Math.max(r,a.y)}return[e,n,i,r]},k.prototype.toGeoJSON=fe.prototype.toGeoJSON;var le=Lt,yt=ue;C.exports=Q,C.exports.fromVectorTileJs=Q,C.exports.fromGeojsonVt=ce,C.exports.GeoJSONWrapper=yt;function Q(t){var e=new le;return de(t,e),e.finish()}function ce(t,e){e=e||{};var i={};for(var n in t)i[n]=new yt(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return Q({layers:i})}function de(t,e){for(var i in t.layers)e.writeMessage(3,xe,t.layers[i])}function xe(t,e){e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i,n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,pe,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var s=n.values;for(i=0;i<s.length;i++)e.writeMessage(4,ge,s[i])}function pe(t,e){var i=t.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,ye,t),e.writeVarintField(3,i.type),e.writeMessage(4,we,i)}function ye(t,e){var i=t.feature,n=t.keys,r=t.values,s=t.keycache,o=t.valuecache;for(var h in i.properties){var a=i.properties[h],f=s[h];if(a!==null){typeof f>"u"&&(n.push(h),f=n.length-1,s[h]=f),e.writeVarint(f);var u=typeof a;u!=="string"&&u!=="boolean"&&u!=="number"&&(a=JSON.stringify(a));var l=u+":"+a,d=o[l];typeof d>"u"&&(r.push(a),d=r.length-1,o[l]=d),e.writeVarint(d)}}}function K(t,e){return(e<<3)+(t&7)}function wt(t){return t<<1^t>>31}function we(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,s=0,o=i.length,h=0;h<o;h++){var a=i[h],f=1;n===1&&(f=a.length),e.writeVarint(K(1,f));for(var u=n===3?a.length-1:a.length,l=0;l<u;l++){l===1&&n!==1&&e.writeVarint(K(2,u-1));var d=a[l].x-r,c=a[l].y-s;e.writeVarint(wt(d)),e.writeVarint(wt(c)),r+=d,s+=c}n===3&&e.writeVarint(K(7,1))}}function ge(t,e){var i=typeof t;i==="string"?e.writeStringField(1,t):i==="boolean"?e.writeBooleanField(7,t):i==="number"&&(t%1!==0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}var me=C.exports,Fe=Et(me);self.onmessage=async t=>{const{id:e,z:i,x:n,y:r,geojson:s}=t.data;try{const h=It(s,{maxZoom:22,tolerance:3,extent:4096,buffer:64}).getTile(i,n,r);if(h){const a=Fe.fromGeojsonVt({geojsonLayer:h},{version:2});self.postMessage({id:e,buffer:a})}else self.postMessage({id:e,error:"Tile not found"})}catch(o){o instanceof Error&&(o.name==="AbortError"?self.postMessage({id:e,error:"Request aborted"}):self.postMessage({id:e,error:o.message}))}}})();
