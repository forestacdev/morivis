var nt=Object.defineProperty;var ot=(r,e,t)=>e in r?nt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var x=(r,e,t)=>ot(r,typeof e!="symbol"?e+"":e,t);import{t as st,h as ae,i as pe,Y as at,at as it,n as ie,L as ct,T as lt,Q as ut,N as dt,O as F,j as ht,E as ft,k as gt,y as mt,au as pt}from"./ByGFX7SO.js";import{b as ye,f as yt}from"./BTEwTIS6.js";import{d as wt,w as C,g as k}from"./D0lhRsbH.js";import{m as z}from"./CWzhDz5V.js";import{d as bt,M as vt,e as Et,C as Tt,D as xt,g as Pt,W as Lt,h as Ct,j as Mt,k as Rt,l as kt}from"./CDs3AC5U.js";import{s as St,g as At}from"./B879h6kA.js";function Fr(r,e,t=!1,n=!1,o=!1){var s=r,a="";st(()=>{var l=at;if(a===(a=e()??"")){ae&&pe();return}if(l.nodes_start!==null&&(it(l.nodes_start,l.nodes_end),l.nodes_start=l.nodes_end=null),a!==""){if(ae){ie.data;for(var d=pe(),i=d;d!==null&&(d.nodeType!==8||d.data!=="");)i=d,d=ct(d);if(d===null)throw lt(),ut;ye(ie,i),s=dt(d);return}var g=a+"";t?g=`<svg>${g}</svg>`:n&&(g=`<math>${g}</math>`);var h=yt(g);if((t||n)&&(h=F(h)),ye(F(h),h.lastChild),t||n)for(;F(h);)s.before(F(h));else s.before(h)}})}function Zr(r,e,...t){var n=r,o=mt,s;ht(()=>{o!==(o=e())&&(s&&(pt(s),s=null),s=gt(()=>o(n,...t)))},ft),ae&&(n=ie)}var It=Object.defineProperty,W=Math.pow,v=(r,e)=>It(r,"name",{value:e,configurable:!0}),M=(r,e,t)=>new Promise((n,o)=>{var s=d=>{try{l(t.next(d))}catch(i){o(i)}},a=d=>{try{l(t.throw(d))}catch(i){o(i)}},l=d=>d.done?n(d.value):Promise.resolve(d.value).then(s,a);l((t=t.apply(r,e)).next())});v((r,e)=>{let t=!1,n="",o=L.GridLayer.extend({createTile:v((s,a)=>{let l=document.createElement("img"),d=new AbortController,i=d.signal;return l.cancel=()=>{d.abort()},t||(r.getHeader().then(g=>{g.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):g.tileType===2?n="image/png":g.tileType===3?n="image/jpeg":g.tileType===4?n="image/webp":g.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(s.z,s.x,s.y,i).then(g=>{if(g){let h=new Blob([g.data],{type:n}),p=window.URL.createObjectURL(h);l.src=p,l.cancel=void 0,a(void 0,l)}}).catch(g=>{if(g.name!=="AbortError")throw g}),l},"createTile"),_removeTile:v(function(s){let a=this._tiles[s];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[s],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new o(e)},"leafletRasterLayer");var Ot=v(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(o=>t(void 0,o.data,o.cacheControl||"",o.expires||""),o=>t(o)).catch(o=>t(o)),{cancel:v(()=>n.abort(),"cancel")}},"v3compat"),Re=class{constructor(e){this.tilev4=v((t,n)=>M(this,null,function*(){if(t.type==="json"){let y=t.url.substr(10),c=this.tiles.get(y);if(c||(c=new K(y),this.tiles.set(y,c)),this.metadata)return{data:yield c.getTileJson(t.url)};let u=yield c.getHeader();return(u.minLon>=u.maxLon||u.minLat>=u.maxLat)&&console.error(`Bounds of PMTiles archive ${u.minLon},${u.minLat},${u.maxLon},${u.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:u.minZoom,maxzoom:u.maxZoom,bounds:[u.minLon,u.minLat,u.maxLon,u.maxLat]}}}let o=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(o);if(!s)throw new Error("Invalid PMTiles protocol URL");let a=s[1],l=this.tiles.get(a);l||(l=new K(a),this.tiles.set(a,l));let d=s[2],i=s[3],g=s[4],h=yield l.getHeader(),p=yield l==null?void 0:l.getZxy(+d,+i,+g,n.signal);if(p)return{data:new Uint8Array(p.data),cacheControl:p.cacheControl,expires:p.expires};if(h.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Ot(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};v(Re,"Protocol");var Ut=Re;function ke(r,e){return(e>>>0)*4294967296+(r>>>0)}v(ke,"toNum");function Se(r,e){let t=e.buf,n=t[e.pos++],o=(n&112)>>4;if(n<128||(n=t[e.pos++],o|=(n&127)<<3,n<128)||(n=t[e.pos++],o|=(n&127)<<10,n<128)||(n=t[e.pos++],o|=(n&127)<<17,n<128)||(n=t[e.pos++],o|=(n&127)<<24,n<128)||(n=t[e.pos++],o|=(n&1)<<31,n<128))return ke(r,o);throw new Error("Expected varint not more than 10 bytes")}v(Se,"readVarintRemainder");function $(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,Se(n,r))}v($,"readVarint");function ue(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let o=e[0];e[0]=e[1],e[1]=o}}v(ue,"rotate");function Ae(r,e){let t=W(2,r),n=e,o=e,s=e,a=[0,0],l=1;for(;l<t;)n=1&s/2,o=1&(s^n),ue(l,a,n,o),a[0]+=l*n,a[1]+=l*o,s=s/4,l*=2;return[r,a[0],a[1]]}v(Ae,"idOnLevel");var qt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ie(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>W(2,r)-1||t>W(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=qt[r],o=W(2,r),s=0,a=0,l=0,d=[e,t],i=o/2;for(;i>0;)s=(d[0]&i)>0?1:0,a=(d[1]&i)>0?1:0,l+=i*i*(3*s^a),ue(i,d,s,a),i=i/2;return n+l}v(Ie,"zxyToTileId");function Bt(r){let e=0;for(let t=0;t<27;t++){let n=(1<<t)*(1<<t);if(e+n>r)return Ae(t,r-e);e+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}v(Bt,"tileIdToZxy");var _t=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(_t||{});function Y(r,e){return M(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return bt(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}v(Y,"defaultDecompress");var Dt=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Dt||{});function Oe(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}v(Oe,"tileTypeExt");var $t=127;function Ue(r,e){let t=0,n=r.length-1;for(;t<=n;){let o=n+t>>1,s=e-r[o].tileId;if(s>0)t=o+1;else if(s<0)n=o-1;else return r[o]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}v(Ue,"findTile");var zt=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return M(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};v(zt,"FileSource");var qe=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let o=n.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,o&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,o){return M(this,null,function*(){let s,a;n?a=n:(s=new AbortController,a=s.signal);let l=new Headers(this.customHeaders);l.set("range",`bytes=${e}-${e+t-1}`);let d;this.mustReload?d="reload":this.chromeWindowsNoCache&&(d="no-store");let i=yield fetch(this.url,{signal:a,cache:d,headers:l});if(e===0&&i.status===416){let p=i.headers.get("Content-Range");if(!p||!p.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let y=+p.substr(8);i=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let g=i.headers.get("Etag");if(g!=null&&g.startsWith("W/")&&(g=null),i.status===416||o&&g&&g!==o)throw this.mustReload=!0,new ce(`Server returned non-matching ETag ${o} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(i.status>=300)throw new Error(`Bad response code: ${i.status}`);let h=i.headers.get("Content-Length");if(i.status===200&&(!h||+h>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield i.arrayBuffer(),etag:g||void 0,cacheControl:i.headers.get("Cache-Control")||void 0,expires:i.headers.get("Expires")||void 0}})}};v(qe,"FetchSource");var jt=qe;function I(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*W(2,32)+n}v(I,"getUint64");function Be(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:I(t,8),rootDirectoryLength:I(t,16),jsonMetadataOffset:I(t,24),jsonMetadataLength:I(t,32),leafDirectoryOffset:I(t,40),leafDirectoryLength:I(t,48),tileDataOffset:I(t,56),tileDataLength:I(t,64),numAddressedTiles:I(t,72),numTileEntries:I(t,80),numTileContents:I(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}v(Be,"bytesToHeader");function de(r){let e={buf:new Uint8Array(r),pos:0},t=$(e),n=[],o=0;for(let s=0;s<t;s++){let a=$(e);n.push({tileId:o+a,offset:0,length:0,runLength:1}),o+=a}for(let s=0;s<t;s++)n[s].runLength=$(e);for(let s=0;s<t;s++)n[s].length=$(e);for(let s=0;s<t;s++){let a=$(e);a===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=a-1}return n}v(de,"deserializeIndex");var _e=class extends Error{};v(_e,"EtagMismatch");var ce=_e;function he(r,e){return M(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,$t),o=Be(n,t.etag),s=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,l=de(yield e(s,o.internalCompression));return[o,[a,l.length,l]]})}v(he,"getHeaderAndRoot");function fe(r,e,t,n,o){return M(this,null,function*(){let s=yield r.getBytes(t,n,void 0,o.etag),a=yield e(s.data,o.internalCompression),l=de(a);if(l.length===0)throw new Error("Empty directory is invalid");return l})}v(fe,"getDirectory");var Nt=class{constructor(e=100,t=!0,n=Y){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return M(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let o=yield he(e,this.decompress);return o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:o[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:o[0]}),this.prune(),o[0]})}getDirectory(e,t,n,o){return M(this,null,function*(){let s=`${e.getKey()}|${o.etag||""}|${t}|${n}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,a.data;let l=yield fe(e,this.decompress,t,n,o);return this.cache.set(s,{lastUsed:this.counter++,data:l}),this.prune(),l})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,o)=>{n.lastUsed<e&&(e=n.lastUsed,t=o)}),t&&this.cache.delete(t)}}invalidate(e){return M(this,null,function*(){this.cache.delete(e.getKey())})}};v(Nt,"ResolvedValueCache");var De=class{constructor(e=100,t=!0,n=Y){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return M(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let o=new Promise((s,a)=>{he(e,this.decompress).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{a(l)})});return this.cache.set(t,{lastUsed:this.counter++,data:o}),o})}getDirectory(e,t,n,o){return M(this,null,function*(){let s=`${e.getKey()}|${o.etag||""}|${t}|${n}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,yield a.data;let l=new Promise((d,i)=>{fe(e,this.decompress,t,n,o).then(g=>{d(g),this.prune()}).catch(g=>{i(g)})});return this.cache.set(s,{lastUsed:this.counter++,data:l}),l})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,o)=>{n.lastUsed<e&&(e=n.lastUsed,t=o)}),t&&this.cache.delete(t)}}invalidate(e){return M(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((o,s)=>{this.getHeader(e).then(a=>{o(),this.invalidations.delete(t)}).catch(a=>{s(a)})});this.invalidations.set(t,n)})}};v(De,"SharedPromiseCache");var Wt=De,$e=class{constructor(e,t,n){typeof e=="string"?this.source=new jt(e):this.source=e,n?this.decompress=n:this.decompress=Y,t?this.cache=t:this.cache=new Wt}getHeader(){return M(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,o){return M(this,null,function*(){let s=Ie(e,t,n),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let l=a.rootDirectoryOffset,d=a.rootDirectoryLength;for(let i=0;i<=3;i++){let g=yield this.cache.getDirectory(this.source,l,d,a),h=Ue(g,s);if(h){if(h.runLength>0){let p=yield this.source.getBytes(a.tileDataOffset+h.offset,h.length,o,a.etag);return{data:yield this.decompress(p.data,a.tileCompression),cacheControl:p.cacheControl,expires:p.expires}}l=a.leafDirectoryOffset+h.offset,d=h.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,o){return M(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,o)}catch(s){if(s instanceof ce)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,o);throw s}})}getMetadataAttempt(){return M(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),o=new TextDecoder("utf-8");return JSON.parse(o.decode(n))})}getMetadata(){return M(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof ce)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return M(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),o=Oe(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${o}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};v($e,"PMTiles");var K=$e;function ze(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function en(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!we(r[0])||!we(r[1]))throw new Error("coordinates must contain numbers");return ze({type:"Point",coordinates:r},e,t)}function Ht(r,e,t={}){for(const o of r){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return ze({type:"Polygon",coordinates:r},e,t)}function tn(r){return r%(2*Math.PI)*180/Math.PI}function rn(r){return r%360*Math.PI/180}function we(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}const Ft=()=>{const r=St;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Zt={subscribe(r){return Ft().page.subscribe(r)}};let Z=String.fromCharCode,je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",V={};function Vt(r,e){if(!V[r]){V[r]={};for(let t=0;t<r.length;t++)V[r][r.charAt(t)]=t}return V[r][e]}function Jt(r){return r==null?"":Kt(r,6,function(e){return je.charAt(e)})}function Gt(r){return r==null?"":r==""?null:Yt((r=r.replace(/ /g,"+")).length,32,function(e){return Vt(je,r.charAt(e))})}function Kt(r,e,t){if(r==null)return"";let n,o,s={},a={},l="",d="",i="",g=2,h=3,p=2,y=[],c=0,u=0,m;for(m=0;m<r.length;m+=1)if(l=r.charAt(m),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),d=i+l,Object.prototype.hasOwnProperty.call(s,d))i=d;else{if(Object.prototype.hasOwnProperty.call(a,i)){if(256>i.charCodeAt(0)){for(n=0;n<p;n++)c<<=1,u==e-1?(u=0,y.push(t(c)),c=0):u++;for(n=0,o=i.charCodeAt(0);n<8;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}else{for(n=0,o=1;n<p;n++)c=c<<1|o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o=0;for(n=0,o=i.charCodeAt(0);n<16;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}--g==0&&(g=Math.pow(2,p),p++),delete a[i]}else for(n=0,o=s[i];n<p;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1;--g==0&&(g=Math.pow(2,p),p++),s[d]=h++,i=String(l)}if(i!==""){if(Object.prototype.hasOwnProperty.call(a,i)){if(256>i.charCodeAt(0)){for(n=0;n<p;n++)c<<=1,u==e-1?(u=0,y.push(t(c)),c=0):u++;for(n=0,o=i.charCodeAt(0);n<8;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}else{for(n=0,o=1;n<p;n++)c=c<<1|o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o=0;for(n=0,o=i.charCodeAt(0);n<16;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}--g==0&&(g=Math.pow(2,p),p++),delete a[i]}else for(n=0,o=s[i];n<p;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1;--g==0&&(g=Math.pow(2,p),p++)}for(n=0,o=2;n<p;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1;for(;;){if(c<<=1,u==e-1){y.push(t(c));break}u++}return y.join("")}function Yt(r,e,t){let n=[],o=4,s=4,a=3,l="",d=[],i,g,h,p,y,c,u,m={val:t(0),position:e,index:1};for(i=0;i<3;i+=1)n[i]=i;for(h=0,y=4,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;switch(h){case 0:for(h=0,y=256,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;u=Z(h);break;case 1:for(h=0,y=65536,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;u=Z(h);break;case 2:return""}for(n[3]=u,g=u,d.push(u);;){if(m.index>r)return"";for(h=0,y=Math.pow(2,a),c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;switch(u=h){case 0:for(h=0,y=256,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;n[s++]=Z(h),u=s-1,o--;break;case 1:for(h=0,y=65536,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;n[s++]=Z(h),u=s-1,o--;break;case 2:return d.join("")}if(o==0&&(o=Math.pow(2,a),a++),n[u])l=n[u];else{if(u!==s)return null;l=g+g.charAt(0)}d.push(l),n[s++]=g+l.charAt(0),o--,g=l,o==0&&(o=Math.pow(2,a),a++)}}let Ne;Ne=Zt;const Xt={keepFocus:!0,noScroll:!0,replaceState:!0},Qt={keepFocus:!0,noScroll:!0,replaceState:!1};function er(r,e,t){var s;const n=Array.from(new Set(Array.from(((s=r==null?void 0:r.keys)==null?void 0:s.call(r))||[]).concat(Object.keys(t??{}))));let o=!1;return[Object.fromEntries(n.map(a=>{if(e[a]!=null)return[a,e[a]];let l=h=>h;const d=t==null?void 0:t[a];typeof d!="boolean"&&typeof(d==null?void 0:d.decode)=="function"&&(l=d.decode);const i=r==null?void 0:r.get(a);let g;return i==null&&(d==null?void 0:d.defaultValue)!=null?(g=d.defaultValue,o=!0):g=l(i),[a,g]})),o]}function tr(r,e,t=(n,o)=>JSON.stringify(n)===JSON.stringify(o)){return typeof r=="object"&&typeof e=="object"&&t(r,e)}function ne({encode:r,decode:e}){function t(n){return{encode:r,decode:e,defaultValue:n}}return t}function rr(r){return{encode:e=>JSON.stringify(e),decode:e=>{if(e===null)return null;try{return JSON.parse(e)}catch{return null}},defaultValue:r}}function nr(r){return{encode:e=>JSON.stringify(e),decode:e=>{if(e===null)return null;try{return JSON.parse(e)}catch{return null}},defaultValue:r}}function or(r){return{encode:e=>Jt(JSON.stringify(e)),decode:e=>{if(!e)return null;try{return JSON.parse(Gt(e)??"")}catch{return null}},defaultValue:r}}const J={number:ne({encode:r=>r.toString(),decode:r=>r?parseFloat(r):null}),boolean:ne({encode:r=>r+"",decode:r=>r!==null&&r!=="false"}),string:ne({encode:r=>r??"",decode:r=>r}),object:rr,array:nr,lz:or},oe=new Set;let be;const ve=new Map;function q(r,{debounceHistory:e=0,pushHistory:t=!0,sort:n=!0,showDefaults:o=!0,equalityFn:s}={}){const a=C({});let l,d=!0;function i(h,p){d=!1;const y=window.location.hash,c=new URLSearchParams(window.location.search),u=m=>{for(const R of Object.keys(h)){if(h[R]==null){m.delete(R);continue}let w=j=>j.toString();const S=r==null?void 0:r[R];typeof S!="boolean"&&typeof(S==null?void 0:S.encode)=="function"&&(w=S.encode);const B=w(h[R]);B==null?m.delete(R):m.set(R,B)}};oe.add(u),clearTimeout(be),be=setTimeout(async()=>{oe.forEach(m=>{m(c)}),clearTimeout(ve.get("queryParameters"));{a.set(h);async function m(){n&&c.sort(),await At(`?${c}${y}`,t?Qt:Xt),a.set({})}p||e===0?m():ve.set("queryParameters",setTimeout(m,e))}oe.clear()})}const{subscribe:g}=wt([Ne,a],([h,p],y)=>{var m;const[c,u]=er((m=h==null?void 0:h.url)==null?void 0:m.searchParams,p,r);if(u&&o&&i(structuredClone(c),d),!tr(l,c,s))return l=structuredClone(c),y(structuredClone(c))});return{set(h){i(h)},subscribe:g,update:h=>{const p=k({subscribe:g}),y=h(p);i(y)}}}const nn=r=>{const e=r.slice(1).split("&"),t={};return e.forEach(n=>{t[n.split("=")[0]]=n.split("=")[1]}),t},sr=()=>{const r=k(q({c:J.string(),z:J.number(),p:J.number(),b:J.number()},{pushHistory:!1}));if(r.c===null||r.c===void 0||r.z===null||r.z===void 0||r.p===null||r.p===void 0||r.b===null||r.b===void 0)return vt;const e=r.c.split(",").map(Number),t=Number(r.z),n=Number(r.p),o=Number(r.b);return{center:e,zoom:t,pitch:n,bearing:o}},ar=r=>{const e=k(q({},{pushHistory:!1})),t=r.center.map(n=>n.toFixed(6));e.c=t,e.z=r.zoom.toFixed(1),e.p=r.pitch.toFixed(0),e.b=r.bearing.toFixed(0),k(Et)||(e.imageId="-1"),k(He)||(e["3d"]="0"),q({},{pushHistory:!1}).set(e)},on=r=>{const e=k(q({}));e.imageId=r,q({},{pushHistory:!1}).set(e)},sn=()=>k(q({},{pushHistory:!1})).imageId,Ee=r=>{const e=k(q({}));e["3d"]=r,q({},{pushHistory:!1}).set(e)},an=()=>k(q({},{pushHistory:!1}))["3d"],cn=r=>{const e=new URLSearchParams;for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];Array.isArray(n)?n.forEach(o=>{e.append(t,o)}):n!=null&&e.append(t,String(n))}return e.toString()},We={mapbox:0,gsi:1,terrarium:2},ln=["jet","hsv","hot","spring","summer","autumn","winter","bone","copper","greys","yignbu","greens","yiorrd","bluered","rdbu","picnic","rainbow","portland","blackbody","earth","electric","viridis","inferno","magma","plasma","warm","cool","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red","oxygen","par","phase","salinity","temperature","turbidity","velocity-blue","velocity-green","cubehelix"],ir={default:0,relief:1,slope:2,aspect:3,curvature:4,shadow:5},U=class U{constructor(e=500){x(this,"imageBaseUrlCache",new Map);x(this,"cache");x(this,"cacheSizeLimit");x(this,"cacheOrder");this.cache=new Map,this.cacheSizeLimit=e,this.cacheOrder=[],this.imageBaseUrlCache=new Map}static getInstance(e=500){return U.instance||(U.instance=new U(e)),U.instance}async loadImagePmtiles(e,t,n){try{let o=U.pmCache.get(e);o||(o=new K(e),U.pmCache.set(e,o));const s=await o.getZxy(t.z,t.x,t.y,n);if(!s||!s.data)throw new Error("Tile data not found");const a=new Blob([s.data],{type:"image/png"});return await createImageBitmap(a)}catch(o){if(o instanceof Error&&o.name==="AbortError")throw o;return await createImageBitmap(new ImageData(1,1))}}async loadImage(e,t){try{const n=await fetch(e,{signal:t});if(!n.ok)throw new Error("Failed to fetch image");return await createImageBitmap(await n.blob())}catch(n){if(n instanceof Error&&n.name==="AbortError")throw n;return await createImageBitmap(new ImageData(1,1))}}async getSingleTileImage(e,t,n,o,s,a,l){const d=s.replace("{x}",t.toString()).replace("{y}",n.toString()).replace("{z}",o.toString());if(this.cache.has(e)){const i=this.cache.get(e);return this.add(e,i),i}try{let i;if(a==="image")i=await this.loadImage(d,l.signal);else if(a==="pmtiles"){const g={x:t,y:n,z:o};i=await this.loadImagePmtiles(d,g,l.signal)}if(!i)throw new Error(`Failed to load image for ${e}`);return this.add(e,i),i}catch(i){if(i instanceof Error&&i.name==="AbortError")throw i;return console.error(`Error in getSingleTileImage for ${e}:`,i),await createImageBitmap(new ImageData(1,1))}}async getAdjacentTilesWithImages(e,t,n,o,s,a,l){const d=[{position:"center",dx:0,dy:0},{position:"left",dx:-1,dy:0},{position:"right",dx:1,dy:0},{position:"top",dx:0,dy:-1},{position:"bottom",dx:0,dy:1}],i={};return await Promise.all(d.map(async({position:g,dx:h,dy:p})=>{const y=t+h,c=n+p,u=`${e}_${y}_${c}_${o}`,R=(this.imageBaseUrlCache.get(e)||s).replace("{x}",y.toString()).replace("{y}",c.toString()).replace("{z}",o.toString());let w=this.cache.get(u);if(!w){if(a==="image")w=await this.loadImage(R,l.signal);else if(a==="pmtiles"){const S={x:y,y:c,z:o};w=await this.loadImagePmtiles(R,S,l.signal)}}w&&(this.add(u,w),i[g]={tileId:u,image:w})})),i}add(e,t){if(this.cacheOrder.length>=this.cacheSizeLimit){const o=this.cacheOrder.shift();o&&this.cache.delete(o)}this.cache.set(e,t);const n=this.cacheOrder.indexOf(e);n>-1&&this.cacheOrder.splice(n,1),this.cacheOrder.push(e)}get(e){return this.cache.get(e)}has(e){return this.cache.has(e)}clear(){this.cache.clear(),this.cacheOrder=[]}getUrlcache(e){return this.imageBaseUrlCache.get(e)}addUrlcache(e,t){this.imageBaseUrlCache.set(e,t)}deleteUrlcache(e){this.imageBaseUrlCache.delete(e)}};x(U,"instance"),x(U,"pmCache",new Map);let le=U,cr=class{constructor(e){x(this,"worker");x(this,"pendingRequests");x(this,"tileCache");x(this,"colorMapCache");x(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data,s=this.pendingRequests.get(t);o?(console.error(`Error processing tile ${t}:`,o),s&&(s.reject(new Error(o)),this.pendingRequests.delete(t))):s&&(s.resolve({data:n}),this.pendingRequests.delete(t))});this.worker=e,this.pendingRequests=new Map,this.tileCache=le.getInstance(),this.colorMapCache=new Tt,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),a=e.searchParams.get("entryId")||"",l=e.origin+e.pathname,d=`${a}_${n}_${o}_${s}`,i=e.searchParams.get("formatType"),g=e.searchParams.get("demType"),h=We[g],p=e.searchParams.get("mode")||"default",y=ir[p],c="buffar";if(p==="relief"){const u=await this.tileCache.getSingleTileImage(d,n,o,s,l,i,t),m=this.colorMapCache.createColorArray(e.searchParams.get("colorMap")||"bone"),R=parseFloat(e.searchParams.get("max")||"10000"),w=parseFloat(e.searchParams.get("min")||"0");return new Promise((S,B)=>{this.pendingRequests.set(d,{resolve:S,reject:B,controller:t}),this.worker.postMessage({tileId:d,center:u,demTypeNumber:h,modeNumber:y,mode:p,elevationColorArray:m,max:R,min:w,encodeType:c})})}else{const u=await this.tileCache.getAdjacentTilesWithImages(a,n,o,s,l,i,t),m=this.colorMapCache.createColorArray(e.searchParams.get("colorMap")||"bone"),R=u.center,w=R.tileId,S=u.left,B=u.right,j=u.top,X=u.bottom,Q=parseFloat(e.searchParams.get("max")||"90"),ee=parseFloat(e.searchParams.get("min")||"0");return new Promise((H,te)=>{this.pendingRequests.set(w,{resolve:H,reject:te,controller:t}),this.worker.postMessage({tileId:w,center:R.image,left:S.image,right:B.image,top:j.image,bottom:X.image,demTypeNumber:h,modeNumber:y,mode:p,elevationColorArray:m,max:Q,min:ee,tile:{x:n,y:o,z:s},encodeType:c})})}}handleError(e){console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()}cancelAllRequests(){this.pendingRequests.size>0&&this.pendingRequests.forEach(({reject:e,controller:t})=>{t.abort(),e(new Error("Request cancelled"))}),console.info("All requests have been cancelled."),this.pendingRequests.clear()}clearCache(){this.tileCache.clear()}};class lr{constructor(e){x(this,"workers",[]);x(this,"workerIndex",0);x(this,"poolSize");this.poolSize=e;for(let t=0;t<e;t++){const n=new Worker(new URL(""+new URL("../workers/worker-Dr9vdl9S.js",import.meta.url).href,import.meta.url),{type:"module"});this.workers.push(new cr(n))}}getNextWorker(){const e=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.poolSize,e}async request(e,t){return this.getNextWorker().request(e,t)}cancelAllRequests(){this.workers.forEach(e=>e.cancelAllRequests())}clearCache(){this.workers.forEach(e=>e.clearCache())}}const se=new lr(2),ur=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return se.request(o,t)},cancelAllRequests:()=>se.cancelAllRequests(),clearCache:()=>se.clearCache()}),dr=180/Math.PI;function Te(r,e){return r/Math.pow(2,e)*360-180}function xe(r,e){const t=Math.PI-2*Math.PI*r/Math.pow(2,e);return dr*Math.atan(.5*(Math.exp(t)-Math.exp(-t)))}function hr(r){const e=Te(r[0]+1,r[2]),t=Te(r[0],r[2]),n=xe(r[1]+1,r[2]),o=xe(r[1],r[2]);return[t,n,e,o]}function fr(r){return[[r[0]*2,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2+1,r[2]+1],[r[0]*2,r[1]*2+1,r[2]+1]]}function gr(r){return[r[0]>>1,r[1]>>1,r[2]-1]}function mr(r){return fr(gr(r))}function pr(r,e={}){const t=Number(r[0]),n=Number(r[1]),o=Number(r[2]),s=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const a=[t,n];return Ht([[a,[o,n],[o,s],[t,s],a]],e.properties,{bbox:r,id:e.id})}var yr=pr;let wr=class{constructor(e){x(this,"worker");x(this,"pendingRequests");x(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data;if(o){const s=this.pendingRequests.get(t);s&&(s.resolve({data:new Uint8Array}),this.pendingRequests.delete(t))}else{const s=this.pendingRequests.get(t);s&&(s.resolve({data:n}),this.pendingRequests.delete(t))}});x(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){try{const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),l={type:"FeatureCollection",features:mr([n,o,s]).map(g=>{const[h,p,y]=g,c=hr([h,p,y]);return{...yr(c),properties:{x:n,y:o,z:s,index:`${y}/${h}/${p}`}}})},{signal:d}=t,i=`${s}/${n}/${o}_tile_index`;return new Promise((g,h)=>{this.pendingRequests.set(i,{resolve:g,reject:h}),d.addEventListener("abort",()=>{this.pendingRequests.delete(i),h(new Error("Request aborted"))}),this.worker.postMessage({id:i,z:s,x:n,y:o,geojson:l})})}catch(n){return Promise.reject(n)}}};const br=new Worker(new URL(""+new URL("../workers/worker-DfC3PjOV.js",import.meta.url).href,import.meta.url),{type:"module"}),vr=new wr(br),Er=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return vr.request(o,t)}}),Pe=new Map,Tr=async(r,e,t)=>{try{let n=Pe.get(r);n||(n=new K(r),Pe.set(r,n));const o=await n.getZxy(e.z,e.x,e.y,t);if(!o||!o.data)throw new Error("Tile data not found");const s=new Blob([o.data],{type:"image/png"});return await createImageBitmap(s)}catch(n){if(n instanceof Error&&n.name==="AbortError")throw new Error("Request aborted");return await createImageBitmap(new ImageData(1,1))}},xr=async(r,e)=>{try{const t=await fetch(r,{signal:e});if(!t.ok)throw new Error("Failed to fetch image");return await createImageBitmap(await t.blob())}catch(t){if(t instanceof Error&&t.name==="AbortError")throw new Error("Request aborted");return await createImageBitmap(new ImageData(1,1))}};class Pr{constructor(e){x(this,"worker");x(this,"pendingRequests");x(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data,s=this.pendingRequests.get(t);o?(console.error(`Error processing tile ${t}:`,o),s&&(s.reject(new Error(o)),this.pendingRequests.delete(t))):s&&(s.resolve({data:n}),this.pendingRequests.delete(t))});x(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){try{const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),a=e.origin+e.pathname,l=e.searchParams.get("entryId")||"",d=`${a}_${l}_${n}_${o}_${s}`,i=e.searchParams.get("formatType")||"image",g=e.searchParams.get("demType")||"mapbox";let h;return i==="pmtiles"?h=await Tr(a,{x:n,y:o,z:s},t.signal):i==="image"&&(h=await xr(a,t.signal)),new Promise((p,y)=>{const c=We[g];this.pendingRequests.set(d,{resolve:p,reject:y,controller:t}),this.worker.postMessage({image:h,demTypeNumber:c,id:d}),t.signal.addEventListener("abort",()=>{this.pendingRequests.delete(d),y(new Error("Request aborted"))})})}catch(n){return Promise.reject(n)}}}const Lr=new Worker(new URL(""+new URL("../workers/worker-qG8lXCev.js",import.meta.url).href,import.meta.url),{type:"module"}),Cr=new Pr(Lr),Mr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return Cr.request(o,t)}}),Rr=new Ut;z.addProtocol("pmtiles",Rr.tile);const Le=ur("webgl");z.addProtocol(Le.protocolName,Le.request);const Ce=Mr("terrain");z.addProtocol(Ce.protocolName,Ce.request);const Me=Er("tile_index");z.addProtocol(Me.protocolName,Me.request);const kr=C(!1),G=C(!0),He=C(!1),Sr=()=>{let r=null,e=null;const{subscribe:t,set:n}=C(null),o=C({bbox:[0,0,0,0],zoom:0,center:[0,0],pitch:0,bearing:0}),s=C(null),a=C(null),l=C(null),d=C(null),i=C(null),g=C(null),h=C(null),p=C(null),y=C(null),c=C(null),u=C(null),m=C(null),R=(f,b)=>{const T=sr();if(e=new z.Map({...T,minZoom:2,container:f,centerClampedToGround:!0,style:b,fadeDuration:0,attributionControl:!1,localIdeographFontFamily:!1,maxPitch:85}),k(xt)&&e.on("data",E=>{}),g.set(b),!e)return;const P=16,_=4,N=new Uint8Array(P*P*_);e.addImage("poi-icon",{width:P,height:P,data:N}),e.once("style.load",()=>{h.set(e)}),e.on("styledata",E=>{e&&(o.set({bbox:re(),zoom:e.getZoom(),center:[e.getCenter().lng,e.getCenter().lat],pitch:e.getPitch(),bearing:e.getBearing()}),p.set(E))}),e.on("load",E=>{m.set(E)}),e.on("click",E=>{k(kr)||s.set(E)}),e.on("resize",E=>{c.set(E)}),e.on("data",E=>{G.set(!0)}),e.on("idle",E=>{G.set(!1)}),e.on("rotate",E=>{if(!e)return;const D=e.getBearing();d.set(D)}),e.on("mousedown",E=>{}),e.on("mouseup",E=>{}),e.on("mouseover",E=>{a.set(E)}),e.on("mouseout",E=>{l.set(E)}),e.on("moveend",E=>{if(!e)return;const D=window.location.href,O=window.location.origin,et=e.getZoom(),me=e.getCenter(),tt=e.getBearing(),rt=e.getPitch();D.startsWith(`${O}/map`)&&ar({center:[me.lng,me.lat],zoom:et,pitch:rt,bearing:tt}),o.set({bbox:re(),zoom:e.getZoom(),center:[e.getCenter().lng,e.getCenter().lat],pitch:e.getPitch(),bearing:e.getBearing()}),y.set(E)}),e.on("zoom",E=>{if(!e)return;const D=e.getZoom();i.set(D)}),u.set(e)},w=f=>f&&typeof f=="object"&&typeof f.getLayer=="function"&&typeof f.setLayoutProperty=="function"&&!f._removed,S=f=>{!e||!w(e)||(g.set(f),e.setStyle(f))},B=(f,b)=>{if(!e||!w(e))return;e.getLayer(f)?e.setFilter(f,b):console.warn(`Layer with ID ${f} does not exist.`)},j=(f,b)=>{!e||!w(e)||(r=new z.Marker({element:f}).setLngLat(b).addTo(e))},X=()=>{if(!e||!w(e))return;const f=[136.91278,35.543576,136.92986,35.556704];e.fitBounds(f,{padding:20,bearing:e.getBearing(),duration:1e3,animate:!0})},Q=async()=>{if(!e||!w(e))return;const f=e.getCanvasContainer(),b=f.clientWidth,T=f.clientHeight;return{canvas:f,witdh:b,height:T}},ee=()=>{!e||!w(e)||r&&r.remove()},H=()=>{!e||!w(e)||e.getTerrain()&&setTimeout(()=>{e&&e.terrain.sourceCache.sourceCache.reload()},200)},te=f=>{if(!(!e||!w(e)))try{f?e.getSource("terrain")&&(e.setTerrain({source:"terrain",exaggeration:1}),Ee("1")):(e.getTerrain()&&e.setTerrain(null),Ee("0"))}catch(b){console.error("Terrain control error:",b)}},Fe=(f,b)=>e==null?void 0:e.queryRenderedFeatures(f,b),Ze=(f,b)=>{!e||!w(e)||e.panTo(f,b)},Ve=f=>{!e||!w(e)||e.panTo(f,{duration:300,padding:{left:400,top:20,right:20,bottom:20}})},Je=f=>{!e||!w(e)||e.easeTo(f)},Ge=async f=>{if(!(!e||!w(e)))if(f.metaData.center){e.easeTo({center:f.metaData.center,zoom:f.metaData.minZoom+1.5,bearing:e.getBearing(),pitch:e.getPitch(),padding:{left:400,top:20,right:20,bottom:20},duration:500});return}else e.fitBounds(f.metaData.bounds,{bearing:e.getBearing(),padding:{left:400,top:20,right:20,bottom:20},duration:500})},Ke=async f=>{if(!e||!w(e))return;const b=Pt(f.geometry);e.fitBounds(b,{bearing:e.getBearing(),padding:{left:400,top:20,right:20,bottom:20},duration:500})},Ye=f=>{if(!e||!w(e))return;const b=e.getSprite();b||console.warn("Sprite is not available yet.");const T=b.find(P=>P.id===f);if(T)return T.url;console.warn(`Sprite with id ${f} not found.`)},re=()=>{if(!e||!w(e))return console.warn("Map is not ready yet."),[0,0,0,0];const f=O=>Math.max(Lt,Math.min(Ct,O)),b=O=>(O=O%360,O>180?O-=360:O<-180&&(O+=360),O),T=e.getBounds(),P=f(T._sw.lat),_=f(T._ne.lat);let N=b(T._sw.lng),E=b(T._ne.lng);return N>E&&(N=Mt,E=Rt),[N,P,E,_]},ge=()=>{if(!e||!w(e)){console.warn("Map is not ready yet.");return}const f=e.getStyle(),b={...f.sources},T=[...f.layers];for(const P of T)e.getLayer(P.id)&&e.removeLayer(P.id);for(const P in b)e.getSource(P)&&e.removeSource(P);for(const[P,_]of Object.entries(b))e.addSource(P,_);for(const P of T)e.addLayer(P);k(He)&&e.setTerrain({source:"terrain",exaggeration:1})},Xe=()=>{!e||!w(e)||(e.setTerrain(null),e.removeSource("terrain"),e.setTerrain({source:"terrain",exaggeration:1}),e.getBounds().toArray(),e.getZoom(),ge(),H())},Qe=f=>{if(!e||!w(e))return;const b=e.getCanvas();b&&(b.style.cursor=f)},A=f=>b=>f.subscribe(T=>{T&&b(T)});return{subscribe:t,init:R,isInitialized:()=>k(u),remove:()=>{!e||!w(e)||(e.remove(),e=null,n(null),a.set(null),l.set(null),d.set(null),i.set(null),g.set(null),G.set(!0),h.set(null),y.set(null),c.set(null),u.set(null),m.set(null),r=null)},addLockonMarker:j,removeLockonMarker:ee,queryRenderedFeatures:Fe,setCursor:Qe,setData:(f,b)=>{if(!e||!w(e))return;const T=e.getSource(f);T?T.setData(b):console.warn(`Source with ID ${f} does not exist.`)},setStyle:S,setFilter:B,setLayoutProperty:(f,b,T,P)=>{if(!(!e||!w(e)))try{e.getLayer(f)?e.setLayoutProperty(f,b,T,P):console.warn(`Layer with ID ${f} does not exist.`)}catch(_){console.error(`Error setting layout property for layer ${f}:`,_)}},setBearing:f=>e==null?void 0:e.setBearing(f),fitBounds:(f,b)=>{!e||!w(e)||e.fitBounds(f,b)},panTo:Ze,panToPoi:Ve,flyTo:(f,b)=>{!e||!w(e)||e.flyTo({center:f,...b})},easeTo:f=>Je(f),focusLayer:Ge,focusFeature:Ke,jumpToFac:X,terrainReload:H,toggleTerrain:te,resetDem:Xe,resetAllSourcesAndLayers:ge,getLockonMarker:()=>r,getMap:()=>e,getZoom:()=>e==null?void 0:e.getZoom(),getCenter:()=>e==null?void 0:e.getCenter(),getPitch:()=>e==null?void 0:e.getPitch(),getBearing:()=>e==null?void 0:e.getBearing(),getTerrain:()=>e==null?void 0:e.getTerrain(),getLayer:f=>{if(!(!e||!w(e)))return e.getLayer(f)},getState:()=>k(o),getImage:f=>e==null?void 0:e.getImage(f),getMapBounds:re,getSpriteUrl:Ye,getCanvas:()=>e==null?void 0:e.getCanvas(),getMapContainer:Q,onSetStyle:A(g),onResize:A(c),onload:A(m),onClick:A(s),onMouseover:A(a),onMouseout:A(l),onRotate:A(d),onZoom:A(i),onMooveEnd:A(y),onLoading:A(G),onInitialized:A(u),onStyleLoad:A(h),onStateChange:o.subscribe}},hn=Sr(),fn=C(!1),gn=C(-1),mn=()=>window.innerWidth>kt,pn=(r,e)=>{let t;if(e==="color"?t="bxs:color-fill":e==="number"?t="lsicon:number-filled":t="bxs:color-fill",!r)return t;switch(r){case"match":return"material-symbols:category-rounded";case"step":return"subway:step-1";case"linear":return"mdi:graph-bell-curve-cumulative";default:return t}};class Ar extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}function yn(r,{signal:e}={}){return new Promise((t,n)=>{const o=()=>{n(new Ar)},s=()=>{clearTimeout(a),o()};if(e!=null&&e.aborted)return o();const a=setTimeout(()=>{e==null||e.removeEventListener("abort",s),t()},r);e==null||e.addEventListener("abort",s,{once:!0})})}export{ln as C,ir as D,le as T,rn as a,hr as b,We as c,yn as d,fn as e,kr as f,pn as g,Fr as h,mn as i,He as j,yr as k,on as l,hn as m,nn as n,cn as o,en as p,sn as q,tn as r,Zr as s,gn as t,an as u,K as x};
