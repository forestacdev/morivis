var ot=Object.defineProperty;var st=(r,e,t)=>e in r?ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var C=(r,e,t)=>st(r,typeof e!="symbol"?e+"":e,t);import{t as at,h as ae,e as pe,X as it,at as ct,l as ie,K as lt,R as ut,P as ht,M as dt,N as H,i as ft,E as gt,j as mt,w as pt,au as yt}from"./BhGCRYfc.js";import{b as ye,f as wt}from"./DGlbTQzB.js";import{d as bt,w as M,g as R}from"./B9cWPNx2.js";import{m as N}from"./CWzhDz5V.js";import{e as vt,M as Et,g as At,C as Pt,D as Tt,W as Ct,h as xt,j as Lt,k as Mt,l as St}from"./CbppkHeU.js";import{s as kt,g as Rt}from"./BwhNy05l.js";function Xr(r,e,t=!1,n=!1,o=!1){var s=r,a="";at(()=>{var l=it;if(a===(a=e()??"")){ae&&pe();return}if(l.nodes_start!==null&&(ct(l.nodes_start,l.nodes_end),l.nodes_start=l.nodes_end=null),a!==""){if(ae){ie.data;for(var u=pe(),i=u;u!==null&&(u.nodeType!==8||u.data!=="");)i=u,u=lt(u);if(u===null)throw ut(),ht;ye(ie,i),s=dt(u);return}var f=a+"";t?f=`<svg>${f}</svg>`:n&&(f=`<math>${f}</math>`);var h=wt(f);if((t||n)&&(h=H(h)),ye(H(h),h.lastChild),t||n)for(;H(h);)s.before(H(h));else s.before(h)}})}function Jr(r,e,...t){var n=r,o=pt,s;ft(()=>{o!==(o=e())&&(s&&(yt(s),s=null),s=mt(()=>o(n,...t)))},gt),ae&&(n=ie)}var It=Object.defineProperty,j=Math.pow,E=(r,e)=>It(r,"name",{value:e,configurable:!0}),S=(r,e,t)=>new Promise((n,o)=>{var s=u=>{try{l(t.next(u))}catch(i){o(i)}},a=u=>{try{l(t.throw(u))}catch(i){o(i)}},l=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,a);l((t=t.apply(r,e)).next())});E((r,e)=>{let t=!1,n="",o=L.GridLayer.extend({createTile:E((s,a)=>{let l=document.createElement("img"),u=new AbortController,i=u.signal;return l.cancel=()=>{u.abort()},t||(r.getHeader().then(f=>{f.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):f.tileType===2?n="image/png":f.tileType===3?n="image/jpeg":f.tileType===4?n="image/webp":f.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(s.z,s.x,s.y,i).then(f=>{if(f){let h=new Blob([f.data],{type:n}),p=window.URL.createObjectURL(h);l.src=p,l.cancel=void 0,a(void 0,l)}}).catch(f=>{if(f.name!=="AbortError")throw f}),l},"createTile"),_removeTile:E(function(s){let a=this._tiles[s];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[s],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new o(e)},"leafletRasterLayer");var Ot=E(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(o=>t(void 0,o.data,o.cacheControl||"",o.expires||""),o=>t(o)).catch(o=>t(o)),{cancel:E(()=>n.abort(),"cancel")}},"v3compat"),Me=class{constructor(e){this.tilev4=E((t,n)=>S(this,null,function*(){if(t.type==="json"){let y=t.url.substr(10),c=this.tiles.get(y);if(c||(c=new Y(y),this.tiles.set(y,c)),this.metadata)return{data:yield c.getTileJson(t.url)};let d=yield c.getHeader();return(d.minLon>=d.maxLon||d.minLat>=d.maxLat)&&console.error(`Bounds of PMTiles archive ${d.minLon},${d.minLat},${d.maxLon},${d.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:d.minZoom,maxzoom:d.maxZoom,bounds:[d.minLon,d.minLat,d.maxLon,d.maxLat]}}}let o=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(o);if(!s)throw new Error("Invalid PMTiles protocol URL");let a=s[1],l=this.tiles.get(a);l||(l=new Y(a),this.tiles.set(a,l));let u=s[2],i=s[3],f=s[4],h=yield l.getHeader(),p=yield l==null?void 0:l.getZxy(+u,+i,+f,n.signal);if(p)return{data:new Uint8Array(p.data),cacheControl:p.cacheControl,expires:p.expires};if(h.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Ot(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};E(Me,"Protocol");var Bt=Me;function Se(r,e){return(e>>>0)*4294967296+(r>>>0)}E(Se,"toNum");function ke(r,e){let t=e.buf,n=t[e.pos++],o=(n&112)>>4;if(n<128||(n=t[e.pos++],o|=(n&127)<<3,n<128)||(n=t[e.pos++],o|=(n&127)<<10,n<128)||(n=t[e.pos++],o|=(n&127)<<17,n<128)||(n=t[e.pos++],o|=(n&127)<<24,n<128)||(n=t[e.pos++],o|=(n&1)<<31,n<128))return Se(r,o);throw new Error("Expected varint not more than 10 bytes")}E(ke,"readVarintRemainder");function _(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,ke(n,r))}E(_,"readVarint");function ue(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let o=e[0];e[0]=e[1],e[1]=o}}E(ue,"rotate");function Re(r,e){let t=j(2,r),n=e,o=e,s=e,a=[0,0],l=1;for(;l<t;)n=1&s/2,o=1&(s^n),ue(l,a,n,o),a[0]+=l*n,a[1]+=l*o,s=s/4,l*=2;return[r,a[0],a[1]]}E(Re,"idOnLevel");var Dt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ie(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>j(2,r)-1||t>j(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=Dt[r],o=j(2,r),s=0,a=0,l=0,u=[e,t],i=o/2;for(;i>0;)s=(u[0]&i)>0?1:0,a=(u[1]&i)>0?1:0,l+=i*i*(3*s^a),ue(i,u,s,a),i=i/2;return n+l}E(Ie,"zxyToTileId");function Ut(r){let e=0;for(let t=0;t<27;t++){let n=(1<<t)*(1<<t);if(e+n>r)return Re(t,r-e);e+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}E(Ut,"tileIdToZxy");var qt=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(qt||{});function G(r,e){return S(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return vt(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}E(G,"defaultDecompress");var zt=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(zt||{});function Oe(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}E(Oe,"tileTypeExt");var Wt=127;function Be(r,e){let t=0,n=r.length-1;for(;t<=n;){let o=n+t>>1,s=e-r[o].tileId;if(s>0)t=o+1;else if(s<0)n=o-1;else return r[o]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}E(Be,"findTile");var _t=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return S(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};E(_t,"FileSource");var De=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let o=n.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,o&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,o){return S(this,null,function*(){let s,a;n?a=n:(s=new AbortController,a=s.signal);let l=new Headers(this.customHeaders);l.set("range",`bytes=${e}-${e+t-1}`);let u;this.mustReload?u="reload":this.chromeWindowsNoCache&&(u="no-store");let i=yield fetch(this.url,{signal:a,cache:u,headers:l});if(e===0&&i.status===416){let p=i.headers.get("Content-Range");if(!p||!p.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let y=+p.substr(8);i=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let f=i.headers.get("Etag");if(f!=null&&f.startsWith("W/")&&(f=null),i.status===416||o&&f&&f!==o)throw this.mustReload=!0,new ce(`Server returned non-matching ETag ${o} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(i.status>=300)throw new Error(`Bad response code: ${i.status}`);let h=i.headers.get("Content-Length");if(i.status===200&&(!h||+h>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield i.arrayBuffer(),etag:f||void 0,cacheControl:i.headers.get("Cache-Control")||void 0,expires:i.headers.get("Expires")||void 0}})}};E(De,"FetchSource");var Nt=De;function B(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*j(2,32)+n}E(B,"getUint64");function Ue(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:B(t,8),rootDirectoryLength:B(t,16),jsonMetadataOffset:B(t,24),jsonMetadataLength:B(t,32),leafDirectoryOffset:B(t,40),leafDirectoryLength:B(t,48),tileDataOffset:B(t,56),tileDataLength:B(t,64),numAddressedTiles:B(t,72),numTileEntries:B(t,80),numTileContents:B(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}E(Ue,"bytesToHeader");function he(r){let e={buf:new Uint8Array(r),pos:0},t=_(e),n=[],o=0;for(let s=0;s<t;s++){let a=_(e);n.push({tileId:o+a,offset:0,length:0,runLength:1}),o+=a}for(let s=0;s<t;s++)n[s].runLength=_(e);for(let s=0;s<t;s++)n[s].length=_(e);for(let s=0;s<t;s++){let a=_(e);a===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=a-1}return n}E(he,"deserializeIndex");var qe=class extends Error{};E(qe,"EtagMismatch");var ce=qe;function de(r,e){return S(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,Wt),o=Ue(n,t.etag),s=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,l=he(yield e(s,o.internalCompression));return[o,[a,l.length,l]]})}E(de,"getHeaderAndRoot");function fe(r,e,t,n,o){return S(this,null,function*(){let s=yield r.getBytes(t,n,void 0,o.etag),a=yield e(s.data,o.internalCompression),l=he(a);if(l.length===0)throw new Error("Empty directory is invalid");return l})}E(fe,"getDirectory");var $t=class{constructor(e=100,t=!0,n=G){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return S(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let o=yield de(e,this.decompress);return o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:o[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:o[0]}),this.prune(),o[0]})}getDirectory(e,t,n,o){return S(this,null,function*(){let s=`${e.getKey()}|${o.etag||""}|${t}|${n}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,a.data;let l=yield fe(e,this.decompress,t,n,o);return this.cache.set(s,{lastUsed:this.counter++,data:l}),this.prune(),l})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,o)=>{n.lastUsed<e&&(e=n.lastUsed,t=o)}),t&&this.cache.delete(t)}}invalidate(e){return S(this,null,function*(){this.cache.delete(e.getKey())})}};E($t,"ResolvedValueCache");var ze=class{constructor(e=100,t=!0,n=G){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return S(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let o=new Promise((s,a)=>{de(e,this.decompress).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{a(l)})});return this.cache.set(t,{lastUsed:this.counter++,data:o}),o})}getDirectory(e,t,n,o){return S(this,null,function*(){let s=`${e.getKey()}|${o.etag||""}|${t}|${n}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,yield a.data;let l=new Promise((u,i)=>{fe(e,this.decompress,t,n,o).then(f=>{u(f),this.prune()}).catch(f=>{i(f)})});return this.cache.set(s,{lastUsed:this.counter++,data:l}),l})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,o)=>{n.lastUsed<e&&(e=n.lastUsed,t=o)}),t&&this.cache.delete(t)}}invalidate(e){return S(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((o,s)=>{this.getHeader(e).then(a=>{o(),this.invalidations.delete(t)}).catch(a=>{s(a)})});this.invalidations.set(t,n)})}};E(ze,"SharedPromiseCache");var jt=ze,We=class{constructor(e,t,n){typeof e=="string"?this.source=new Nt(e):this.source=e,n?this.decompress=n:this.decompress=G,t?this.cache=t:this.cache=new jt}getHeader(){return S(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,o){return S(this,null,function*(){let s=Ie(e,t,n),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let l=a.rootDirectoryOffset,u=a.rootDirectoryLength;for(let i=0;i<=3;i++){let f=yield this.cache.getDirectory(this.source,l,u,a),h=Be(f,s);if(h){if(h.runLength>0){let p=yield this.source.getBytes(a.tileDataOffset+h.offset,h.length,o,a.etag);return{data:yield this.decompress(p.data,a.tileCompression),cacheControl:p.cacheControl,expires:p.expires}}l=a.leafDirectoryOffset+h.offset,u=h.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,o){return S(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,o)}catch(s){if(s instanceof ce)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,o);throw s}})}getMetadataAttempt(){return S(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),o=new TextDecoder("utf-8");return JSON.parse(o.decode(n))})}getMetadata(){return S(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof ce)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return S(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),o=Oe(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${o}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};E(We,"PMTiles");var Y=We;function _e(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function nn(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!we(r[0])||!we(r[1]))throw new Error("coordinates must contain numbers");return _e({type:"Point",coordinates:r},e,t)}function Zt(r,e,t={}){for(const o of r){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return _e({type:"Polygon",coordinates:r},e,t)}function on(r){return r%(2*Math.PI)*180/Math.PI}function sn(r){return r%360*Math.PI/180}function we(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ne(r,e,t){if(r!==null)for(var n,o,s,a,l,u,i,f=0,h=0,p,y=r.type,c=y==="FeatureCollection",d=y==="Feature",m=c?r.features.length:1,A=0;A<m;A++){i=c?r.features[A].geometry:d?r.geometry:r,p=i?i.type==="GeometryCollection":!1,l=p?i.geometries.length:1;for(var w=0;w<l;w++){var P=0,k=0;if(a=p?i.geometries[w]:i,a!==null){u=a.coordinates;var I=a.type;switch(f=0,I){case null:break;case"Point":if(e(u,h,A,P,k)===!1)return!1;h++,P++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(e(u[n],h,A,P,k)===!1)return!1;h++,I==="MultiPoint"&&P++}I==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-f;o++){if(e(u[n][o],h,A,P,k)===!1)return!1;h++}I==="MultiLineString"&&P++,I==="Polygon"&&k++}I==="Polygon"&&P++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(k=0,o=0;o<u[n].length;o++){for(s=0;s<u[n][o].length-f;s++){if(e(u[n][o][s],h,A,P,k)===!1)return!1;h++}k++}P++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(Ne(a.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ht(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Ne(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Ft=Ht;const Vt=()=>{const r=kt;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Xt={subscribe(r){return Vt().page.subscribe(r)}};let F=String.fromCharCode,$e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",V={};function Jt(r,e){if(!V[r]){V[r]={};for(let t=0;t<r.length;t++)V[r][r.charAt(t)]=t}return V[r][e]}function Yt(r){return r==null?"":Kt(r,6,function(e){return $e.charAt(e)})}function Gt(r){return r==null?"":r==""?null:Qt((r=r.replace(/ /g,"+")).length,32,function(e){return Jt($e,r.charAt(e))})}function Kt(r,e,t){if(r==null)return"";let n,o,s={},a={},l="",u="",i="",f=2,h=3,p=2,y=[],c=0,d=0,m;for(m=0;m<r.length;m+=1)if(l=r.charAt(m),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),u=i+l,Object.prototype.hasOwnProperty.call(s,u))i=u;else{if(Object.prototype.hasOwnProperty.call(a,i)){if(256>i.charCodeAt(0)){for(n=0;n<p;n++)c<<=1,d==e-1?(d=0,y.push(t(c)),c=0):d++;for(n=0,o=i.charCodeAt(0);n<8;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1}else{for(n=0,o=1;n<p;n++)c=c<<1|o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o=0;for(n=0,o=i.charCodeAt(0);n<16;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1}--f==0&&(f=Math.pow(2,p),p++),delete a[i]}else for(n=0,o=s[i];n<p;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1;--f==0&&(f=Math.pow(2,p),p++),s[u]=h++,i=String(l)}if(i!==""){if(Object.prototype.hasOwnProperty.call(a,i)){if(256>i.charCodeAt(0)){for(n=0;n<p;n++)c<<=1,d==e-1?(d=0,y.push(t(c)),c=0):d++;for(n=0,o=i.charCodeAt(0);n<8;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1}else{for(n=0,o=1;n<p;n++)c=c<<1|o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o=0;for(n=0,o=i.charCodeAt(0);n<16;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1}--f==0&&(f=Math.pow(2,p),p++),delete a[i]}else for(n=0,o=s[i];n<p;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1;--f==0&&(f=Math.pow(2,p),p++)}for(n=0,o=2;n<p;n++)c=c<<1|1&o,d==e-1?(d=0,y.push(t(c)),c=0):d++,o>>=1;for(;;){if(c<<=1,d==e-1){y.push(t(c));break}d++}return y.join("")}function Qt(r,e,t){let n=[],o=4,s=4,a=3,l="",u=[],i,f,h,p,y,c,d,m={val:t(0),position:e,index:1};for(i=0;i<3;i+=1)n[i]=i;for(h=0,y=4,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;switch(h){case 0:for(h=0,y=256,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;d=F(h);break;case 1:for(h=0,y=65536,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;d=F(h);break;case 2:return""}for(n[3]=d,f=d,u.push(d);;){if(m.index>r)return"";for(h=0,y=Math.pow(2,a),c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;switch(d=h){case 0:for(h=0,y=256,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;n[s++]=F(h),d=s-1,o--;break;case 1:for(h=0,y=65536,c=1;c!=y;)p=m.val&m.position,m.position>>=1,m.position==0&&(m.position=e,m.val=t(m.index++)),h|=(p>0?1:0)*c,c<<=1;n[s++]=F(h),d=s-1,o--;break;case 2:return u.join("")}if(o==0&&(o=Math.pow(2,a),a++),n[d])l=n[d];else{if(d!==s)return null;l=f+f.charAt(0)}u.push(l),n[s++]=f+l.charAt(0),o--,f=l,o==0&&(o=Math.pow(2,a),a++)}}let je;je=Xt;const er={keepFocus:!0,noScroll:!0,replaceState:!0},tr={keepFocus:!0,noScroll:!0,replaceState:!1};function rr(r,e,t){var s;const n=Array.from(new Set(Array.from(((s=r==null?void 0:r.keys)==null?void 0:s.call(r))||[]).concat(Object.keys(t??{}))));let o=!1;return[Object.fromEntries(n.map(a=>{if(e[a]!=null)return[a,e[a]];let l=h=>h;const u=t==null?void 0:t[a];typeof u!="boolean"&&typeof(u==null?void 0:u.decode)=="function"&&(l=u.decode);const i=r==null?void 0:r.get(a);let f;return i==null&&(u==null?void 0:u.defaultValue)!=null?(f=u.defaultValue,o=!0):f=l(i),[a,f]})),o]}function nr(r,e,t=(n,o)=>JSON.stringify(n)===JSON.stringify(o)){return typeof r=="object"&&typeof e=="object"&&t(r,e)}function ne({encode:r,decode:e}){function t(n){return{encode:r,decode:e,defaultValue:n}}return t}function or(r){return{encode:e=>JSON.stringify(e),decode:e=>{if(e===null)return null;try{return JSON.parse(e)}catch{return null}},defaultValue:r}}function sr(r){return{encode:e=>JSON.stringify(e),decode:e=>{if(e===null)return null;try{return JSON.parse(e)}catch{return null}},defaultValue:r}}function ar(r){return{encode:e=>Yt(JSON.stringify(e)),decode:e=>{if(!e)return null;try{return JSON.parse(Gt(e)??"")}catch{return null}},defaultValue:r}}const X={number:ne({encode:r=>r.toString(),decode:r=>r?parseFloat(r):null}),boolean:ne({encode:r=>r+"",decode:r=>r!==null&&r!=="false"}),string:ne({encode:r=>r??"",decode:r=>r}),object:or,array:sr,lz:ar},oe=new Set;let be;const ve=new Map;function z(r,{debounceHistory:e=0,pushHistory:t=!0,sort:n=!0,showDefaults:o=!0,equalityFn:s}={}){const a=M({});let l,u=!0;function i(h,p){u=!1;const y=window.location.hash,c=new URLSearchParams(window.location.search),d=m=>{for(const A of Object.keys(h)){if(h[A]==null){m.delete(A);continue}let w=I=>I.toString();const P=r==null?void 0:r[A];typeof P!="boolean"&&typeof(P==null?void 0:P.encode)=="function"&&(w=P.encode);const k=w(h[A]);k==null?m.delete(A):m.set(A,k)}};oe.add(d),clearTimeout(be),be=setTimeout(async()=>{oe.forEach(m=>{m(c)}),clearTimeout(ve.get("queryParameters"));{a.set(h);async function m(){n&&c.sort(),await Rt(`?${c}${y}`,t?tr:er),a.set({})}p||e===0?m():ve.set("queryParameters",setTimeout(m,e))}oe.clear()})}const{subscribe:f}=bt([je,a],([h,p],y)=>{var m;const[c,d]=rr((m=h==null?void 0:h.url)==null?void 0:m.searchParams,p,r);if(d&&o&&i(structuredClone(c),u),!nr(l,c,s))return l=structuredClone(c),y(structuredClone(c))});return{set(h){i(h)},subscribe:f,update:h=>{const p=R({subscribe:f}),y=h(p);i(y)}}}const an=r=>{const e=r.slice(1).split("&"),t={};return e.forEach(n=>{t[n.split("=")[0]]=n.split("=")[1]}),t},ir=()=>{const r=R(z({c:X.string(),z:X.number(),p:X.number(),b:X.number()},{pushHistory:!1}));if(r.c===null||r.c===void 0||r.z===null||r.z===void 0||r.p===null||r.p===void 0||r.b===null||r.b===void 0)return Et;const e=r.c.split(",").map(Number),t=Number(r.z),n=Number(r.p),o=Number(r.b);return{center:e,zoom:t,pitch:n,bearing:o}},cr=r=>{const e=R(z({},{pushHistory:!1})),t=r.center.map(n=>n.toFixed(6));e.c=t,e.z=r.zoom.toFixed(1),e.p=r.pitch.toFixed(0),e.b=r.bearing.toFixed(0),R(At)||(e.imageId="-1"),R(He)||(e["3d"]="0"),z({},{pushHistory:!1}).set(e)},cn=r=>{const e=R(z({}));e.imageId=r,z({},{pushHistory:!1}).set(e)},Ee=r=>{const e=R(z({}));e["3d"]=r,z({},{pushHistory:!1}).set(e)},ln=()=>R(z({},{pushHistory:!1}))["3d"],un=r=>{const e=new URLSearchParams;for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];Array.isArray(n)?n.forEach(o=>{e.append(t,o)}):n!=null&&e.append(t,String(n))}return e.toString()},Ze={mapbox:0,gsi:1,terrarium:2},hn=["jet","hsv","hot","spring","summer","autumn","winter","bone","copper","greys","yignbu","greens","yiorrd","bluered","rdbu","picnic","rainbow","portland","blackbody","earth","electric","viridis","inferno","magma","plasma","warm","cool","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red","oxygen","par","phase","salinity","temperature","turbidity","velocity-blue","velocity-green","cubehelix"],lr={default:0,relief:1,slope:2,aspect:3,curvature:4,shadow:5},U=class U{constructor(e=500){C(this,"imageBaseUrlCache",new Map);C(this,"cache");C(this,"cacheSizeLimit");C(this,"cacheOrder");this.cache=new Map,this.cacheSizeLimit=e,this.cacheOrder=[],this.imageBaseUrlCache=new Map}static getInstance(e=500){return U.instance||(U.instance=new U(e)),U.instance}async loadImagePmtiles(e,t,n){try{let o=U.pmCache.get(e);o||(o=new Y(e),U.pmCache.set(e,o));const s=await o.getZxy(t.z,t.x,t.y,n);if(!s||!s.data)throw new Error("Tile data not found");const a=new Blob([s.data],{type:"image/png"});return await createImageBitmap(a)}catch(o){if(o instanceof Error&&o.name==="AbortError")throw o;return await createImageBitmap(new ImageData(1,1))}}async loadImage(e,t){try{const n=await fetch(e,{signal:t});if(!n.ok)throw new Error("Failed to fetch image");return await createImageBitmap(await n.blob())}catch(n){if(n instanceof Error&&n.name==="AbortError")throw n;return await createImageBitmap(new ImageData(1,1))}}async getSingleTileImage(e,t,n,o,s,a,l){const u=s.replace("{x}",t.toString()).replace("{y}",n.toString()).replace("{z}",o.toString());if(this.cache.has(e)){const i=this.cache.get(e);return this.add(e,i),i}try{let i;if(a==="image")i=await this.loadImage(u,l.signal);else if(a==="pmtiles"){const f={x:t,y:n,z:o};i=await this.loadImagePmtiles(u,f,l.signal)}if(!i)throw new Error(`Failed to load image for ${e}`);return this.add(e,i),i}catch(i){if(i instanceof Error&&i.name==="AbortError")throw i;return console.error(`Error in getSingleTileImage for ${e}:`,i),await createImageBitmap(new ImageData(1,1))}}async getAdjacentTilesWithImages(e,t,n,o,s,a,l){const u=[{position:"center",dx:0,dy:0},{position:"left",dx:-1,dy:0},{position:"right",dx:1,dy:0},{position:"top",dx:0,dy:-1},{position:"bottom",dx:0,dy:1}],i={};return await Promise.all(u.map(async({position:f,dx:h,dy:p})=>{const y=t+h,c=n+p,d=`${e}_${y}_${c}_${o}`,A=(this.imageBaseUrlCache.get(e)||s).replace("{x}",y.toString()).replace("{y}",c.toString()).replace("{z}",o.toString());let w=this.cache.get(d);if(!w){if(a==="image")w=await this.loadImage(A,l.signal);else if(a==="pmtiles"){const P={x:y,y:c,z:o};w=await this.loadImagePmtiles(A,P,l.signal)}}w&&(this.add(d,w),i[f]={tileId:d,image:w})})),i}add(e,t){if(this.cacheOrder.length>=this.cacheSizeLimit){const o=this.cacheOrder.shift();o&&this.cache.delete(o)}this.cache.set(e,t);const n=this.cacheOrder.indexOf(e);n>-1&&this.cacheOrder.splice(n,1),this.cacheOrder.push(e)}get(e){return this.cache.get(e)}has(e){return this.cache.has(e)}clear(){this.cache.clear(),this.cacheOrder=[]}getUrlcache(e){return this.imageBaseUrlCache.get(e)}addUrlcache(e,t){this.imageBaseUrlCache.set(e,t)}deleteUrlcache(e){this.imageBaseUrlCache.delete(e)}};C(U,"instance"),C(U,"pmCache",new Map);let le=U,ur=class{constructor(e){C(this,"worker");C(this,"pendingRequests");C(this,"tileCache");C(this,"colorMapCache");C(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data,s=this.pendingRequests.get(t);o?(console.error(`Error processing tile ${t}:`,o),s&&(s.reject(new Error(o)),this.pendingRequests.delete(t))):s&&(s.resolve({data:n}),this.pendingRequests.delete(t))});this.worker=e,this.pendingRequests=new Map,this.tileCache=le.getInstance(),this.colorMapCache=new Pt,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),a=e.searchParams.get("entryId")||"",l=e.origin+e.pathname,u=`${a}_${n}_${o}_${s}`,i=e.searchParams.get("formatType"),f=e.searchParams.get("demType"),h=Ze[f],p=e.searchParams.get("mode")||"default",y=lr[p],c="buffar";if(p==="relief"){const d=await this.tileCache.getSingleTileImage(u,n,o,s,l,i,t),m=this.colorMapCache.createColorArray(e.searchParams.get("colorMap")||"bone"),A=parseFloat(e.searchParams.get("max")||"10000"),w=parseFloat(e.searchParams.get("min")||"0");return new Promise((P,k)=>{this.pendingRequests.set(u,{resolve:P,reject:k,controller:t}),this.worker.postMessage({tileId:u,center:d,demTypeNumber:h,modeNumber:y,mode:p,elevationColorArray:m,max:A,min:w,encodeType:c})})}else{const d=await this.tileCache.getAdjacentTilesWithImages(a,n,o,s,l,i,t),m=this.colorMapCache.createColorArray(e.searchParams.get("colorMap")||"bone"),A=d.center,w=A.tileId,P=d.left,k=d.right,I=d.top,K=d.bottom,Q=parseFloat(e.searchParams.get("max")||"90"),ee=parseFloat(e.searchParams.get("min")||"0");return new Promise((Z,te)=>{this.pendingRequests.set(w,{resolve:Z,reject:te,controller:t}),this.worker.postMessage({tileId:w,center:A.image,left:P.image,right:k.image,top:I.image,bottom:K.image,demTypeNumber:h,modeNumber:y,mode:p,elevationColorArray:m,max:Q,min:ee,tile:{x:n,y:o,z:s},encodeType:c})})}}handleError(e){console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()}cancelAllRequests(){this.pendingRequests.size>0&&this.pendingRequests.forEach(({reject:e,controller:t})=>{t.abort(),e(new Error("Request cancelled"))}),console.info("All requests have been cancelled."),this.pendingRequests.clear()}clearCache(){this.tileCache.clear()}};class hr{constructor(e){C(this,"workers",[]);C(this,"workerIndex",0);C(this,"poolSize");this.poolSize=e;for(let t=0;t<e;t++){const n=new Worker(new URL(""+new URL("../workers/worker-Dr9vdl9S.js",import.meta.url).href,import.meta.url),{type:"module"});this.workers.push(new ur(n))}}getNextWorker(){const e=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.poolSize,e}async request(e,t){return this.getNextWorker().request(e,t)}cancelAllRequests(){this.workers.forEach(e=>e.cancelAllRequests())}clearCache(){this.workers.forEach(e=>e.clearCache())}}const se=new hr(2),dr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return se.request(o,t)},cancelAllRequests:()=>se.cancelAllRequests(),clearCache:()=>se.clearCache()}),fr=180/Math.PI;function Ae(r,e){return r/Math.pow(2,e)*360-180}function Pe(r,e){const t=Math.PI-2*Math.PI*r/Math.pow(2,e);return fr*Math.atan(.5*(Math.exp(t)-Math.exp(-t)))}function gr(r){const e=Ae(r[0]+1,r[2]),t=Ae(r[0],r[2]),n=Pe(r[1]+1,r[2]),o=Pe(r[1],r[2]);return[t,n,e,o]}function mr(r){return[[r[0]*2,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2+1,r[2]+1],[r[0]*2,r[1]*2+1,r[2]+1]]}function pr(r){return[r[0]>>1,r[1]>>1,r[2]-1]}function yr(r){return mr(pr(r))}function wr(r,e={}){const t=Number(r[0]),n=Number(r[1]),o=Number(r[2]),s=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const a=[t,n];return Zt([[a,[o,n],[o,s],[t,s],a]],e.properties,{bbox:r,id:e.id})}var br=wr;let vr=class{constructor(e){C(this,"worker");C(this,"pendingRequests");C(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data;if(o){const s=this.pendingRequests.get(t);s&&(s.resolve({data:new Uint8Array}),this.pendingRequests.delete(t))}else{const s=this.pendingRequests.get(t);s&&(s.resolve({data:n}),this.pendingRequests.delete(t))}});C(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){try{const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),l={type:"FeatureCollection",features:yr([n,o,s]).map(f=>{const[h,p,y]=f,c=gr([h,p,y]);return{...br(c),properties:{x:n,y:o,z:s,index:`${y}/${h}/${p}`}}})},{signal:u}=t,i=`${s}/${n}/${o}_tile_index`;return new Promise((f,h)=>{this.pendingRequests.set(i,{resolve:f,reject:h}),u.addEventListener("abort",()=>{this.pendingRequests.delete(i),h(new Error("Request aborted"))}),this.worker.postMessage({id:i,z:s,x:n,y:o,geojson:l})})}catch(n){return Promise.reject(n)}}};const Er=new Worker(new URL(""+new URL("../workers/worker-DfC3PjOV.js",import.meta.url).href,import.meta.url),{type:"module"}),Ar=new vr(Er),Pr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return Ar.request(o,t)}}),Te=new Map,Tr=async(r,e,t)=>{try{let n=Te.get(r);n||(n=new Y(r),Te.set(r,n));const o=await n.getZxy(e.z,e.x,e.y,t);if(!o||!o.data)throw new Error("Tile data not found");const s=new Blob([o.data],{type:"image/png"});return await createImageBitmap(s)}catch(n){if(n instanceof Error&&n.name==="AbortError")throw new Error("Request aborted");return await createImageBitmap(new ImageData(1,1))}},Cr=async(r,e)=>{try{const t=await fetch(r,{signal:e});if(!t.ok)throw new Error("Failed to fetch image");return await createImageBitmap(await t.blob())}catch(t){if(t instanceof Error&&t.name==="AbortError")throw new Error("Request aborted");return await createImageBitmap(new ImageData(1,1))}};class xr{constructor(e){C(this,"worker");C(this,"pendingRequests");C(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data,s=this.pendingRequests.get(t);o?(console.error(`Error processing tile ${t}:`,o),s&&(s.reject(new Error(o)),this.pendingRequests.delete(t))):s&&(s.resolve({data:n}),this.pendingRequests.delete(t))});C(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){try{const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),a=e.origin+e.pathname,l=e.searchParams.get("entryId")||"",u=`${a}_${l}_${n}_${o}_${s}`,i=e.searchParams.get("formatType")||"image",f=e.searchParams.get("demType")||"mapbox";let h;return i==="pmtiles"?h=await Tr(a,{x:n,y:o,z:s},t.signal):i==="image"&&(h=await Cr(a,t.signal)),new Promise((p,y)=>{const c=Ze[f];this.pendingRequests.set(u,{resolve:p,reject:y,controller:t}),this.worker.postMessage({image:h,demTypeNumber:c,id:u}),t.signal.addEventListener("abort",()=>{this.pendingRequests.delete(u),y(new Error("Request aborted"))})})}catch(n){return Promise.reject(n)}}}const Lr=new Worker(new URL(""+new URL("../workers/worker-qG8lXCev.js",import.meta.url).href,import.meta.url),{type:"module"}),Mr=new xr(Lr),Sr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return Mr.request(o,t)}}),kr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAkCAYAAAB4+EEtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQLSURBVHgBrVdLbxNXFD537jySMDGD826bKolUxAIa/4BKnbAKQlW74AfEakGqhARdQoSIF5QsqVSpElnU3XdBgAUbiNmxY0AIifeQBOKAkzjx+zXDPZc4msS+40nIJyW277k+n893zj33DIEWiEz9a4BannBdOgrEMcEFgy0bn63EAuLaxIVZkJSEdSFq+/kifiSOVj0nSdJ5pdMw5I4QyLoORKJAqMz31Ip59leAanYDyukVtiLFmT0mIm1K9v309XMSoVNauM/Qunq3nPvBKZc4YfHDe5s5jVmTZ+I799AGoqszl6msTXcOH2lTQodYJBIEAf4g+UAnqEaXUcms/9J7/CQs3711X0iGRLLWPtU5coSlQIW9AElVoxuqmXWzZ+zENsItssiV6xOSol1DoiCy+RIyNdSDYaisr5r9YyfWk3dvP+DrnOjqP0Os2uZC3x0bklQN9guYx8zrp2koSMPWVDTNE+I69HJbz1f7SoRAf1hkoJTP42fCo3Lom9DhY+BH1t+hwqmRXhgfDIOuUEjmy2ClshB/vsTfi+DWarDx4jGPTgaHmqyCfInGB7vg7NGvOYmXfPzbMPwwcBD+frIIdxZWm36XUAqKbhiVWmpCcgn8LOsh8ItoJ5EXuH726Dd8nwjyAeafdSAJXDJE29qFGycODwiJvISnRnp8yHTW5RyTFYgboW0dwo2Rbh2CAKUWYfMoGS3bg588XvhFj3mrk6WxYkTIVsQ2L1pVJPJIQIiF3VuEOwsrEATWSkZoQ/+E8UjEde5XNtLCjf+//tgyOrTHnyWF9vJaiv13ZiWoqNfK6RSIpER58ByJCHEd7X4yVvNZljj1Bk0mZot9x38yWZhDeEU0w8uNAtx7v8aLQFdk/ookN9+mYNqaZxJmhUR4x1XWVuPWxV//4zVJahArrSybWldfvXKaRjj9cB52C3aZsiZJY/iel7516XTCdZwEN+wjMCq3XInXx4Stc0ZINcqiS/tV5m6A1wv78el6VNvIrAu/s9nB/Su/aMN+AFVyS8Vtw0/DwDN6ZeYhG3Ii7QODsFegfPnFN/ajyTPD3vWGdsWi43JWcxnYCzblY6OBMrbT1kDGRjCLuCSWf2eDXxsTYVO+P5rNjsIhdfTPmTkt3GvuRk6mCBSX3sWtyd+izezCrs+rc3XZxu4SBChfYWnB9lZfYDJenTUSZQ64o1ZEWfs5exQgUb953/cKTs7dsvt/PElYbzO1sPgmxuPi5LIx61LjyO0FgQDwyx8WROnjUsK6eHqslZ9Ag3w9fzuPA37GBwkgcjSIn0Bk9fzl5l9u5Q9f8Xi0ypMXFAKinr9aqWCqh7ohN/8KnHyuZZ68CJQzLzB/codu1vLZQHn6YrAnngjsAZ8Atlzok2bc1twAAAAASUVORK5CYII=",Rr=new Bt;N.addProtocol("pmtiles",Rr.tile);const Ce=dr("webgl");N.addProtocol(Ce.protocolName,Ce.request);const xe=Sr("terrain");N.addProtocol(xe.protocolName,xe.request);const Le=Pr("tile_index");N.addProtocol(Le.protocolName,Le.request);const Ir=M(!1),J=M(!0),He=M(!1),Or=()=>{let r=null,e=null;const{subscribe:t,set:n}=M(null),o=M({bbox:[0,0,0,0],zoom:0,center:[0,0],pitch:0,bearing:0}),s=M(null),a=M(null),l=M(null),u=M(null),i=M(null),f=M(null),h=M(null),p=M(null),y=M(null),c=M(null),d=M(null),m=M(null),A=(g,b)=>{const T=ir();if(e=new N.Map({...T,minZoom:2,container:g,centerClampedToGround:!0,style:b,fadeDuration:0,attributionControl:!1,localIdeographFontFamily:!1,maxPitch:85}),R(Tt)&&e.on("data",v=>{}),f.set(b),!e)return;const x=16,W=4,$=new Uint8Array(x*x*W);e.addImage("poi-icon",{width:x,height:x,data:$}),fetch(kr,{mode:"cors"}).then(async v=>{if(!v.ok)throw new Error(`Failed to fetch image: ${v.statusText}`);const q=await createImageBitmap(await v.blob());e&&e.addImage("marker_png",q)}),e.once("style.load",()=>{h.set(e)}),e.on("styledata",v=>{e&&(o.set({bbox:re(),zoom:e.getZoom(),center:[e.getCenter().lng,e.getCenter().lat],pitch:e.getPitch(),bearing:e.getBearing()}),p.set(v))}),e.on("load",v=>{m.set(v)}),e.on("click",v=>{R(Ir)||s.set(v)}),e.on("resize",v=>{c.set(v)}),e.on("data",v=>{J.set(!0)}),e.on("idle",v=>{J.set(!1)}),e.on("rotate",v=>{if(!e)return;const q=e.getBearing();u.set(q)}),e.on("mousedown",v=>{}),e.on("mouseup",v=>{}),e.on("mouseover",v=>{a.set(v)}),e.on("mouseout",v=>{l.set(v)}),e.on("moveend",v=>{if(!e)return;const q=window.location.href,D=window.location.origin,tt=e.getZoom(),me=e.getCenter(),rt=e.getBearing(),nt=e.getPitch();q.startsWith(`${D}/map`)&&cr({center:[me.lng,me.lat],zoom:tt,pitch:nt,bearing:rt}),o.set({bbox:re(),zoom:e.getZoom(),center:[e.getCenter().lng,e.getCenter().lat],pitch:e.getPitch(),bearing:e.getBearing()}),y.set(v)}),e.on("zoom",v=>{if(!e)return;const q=e.getZoom();i.set(q)}),d.set(e)},w=g=>g&&typeof g=="object"&&typeof g.getLayer=="function"&&typeof g.setLayoutProperty=="function"&&!g._removed,P=g=>{!e||!w(e)||(f.set(g),e.setStyle(g))},k=(g,b)=>{if(!e||!w(e))return;e.getLayer(g)?e.setFilter(g,b):console.warn(`Layer with ID ${g} does not exist.`)},I=(g,b)=>{!e||!w(e)||(r=new N.Marker({element:g}).setLngLat(b).addTo(e))},K=()=>{if(!e||!w(e))return;const g=[136.91278,35.543576,136.92986,35.556704];e.fitBounds(g,{padding:20,bearing:e.getBearing(),duration:1e3,animate:!0})},Q=async()=>{if(!e||!w(e))return;const g=e.getCanvasContainer(),b=g.clientWidth,T=g.clientHeight;return{canvas:g,witdh:b,height:T}},ee=()=>{!e||!w(e)||r&&r.remove()},Z=()=>{!e||!w(e)||e.getTerrain()&&setTimeout(()=>{e&&e.terrain.sourceCache.sourceCache.reload()},200)},te=g=>{if(!(!e||!w(e)))try{g?e.getSource("terrain")&&(e.setTerrain({source:"terrain",exaggeration:1}),Ee("1")):(e.getTerrain()&&e.setTerrain(null),Ee("0"))}catch(b){console.error("Terrain control error:",b)}},Fe=(g,b)=>e==null?void 0:e.queryRenderedFeatures(g,b),Ve=(g,b)=>{!e||!w(e)||e.panTo(g,b)},Xe=g=>{!e||!w(e)||e.panTo(g,{duration:300})},Je=g=>{!e||!w(e)||e.easeTo(g)},Ye=async g=>{if(!(!e||!w(e)))if(g.metaData.center){e.easeTo({center:g.metaData.center,zoom:g.metaData.minZoom+1.5,bearing:e.getBearing(),pitch:e.getPitch(),padding:{left:20,top:20,right:20,bottom:20},duration:500});return}else e.fitBounds(g.metaData.bounds,{bearing:e.getBearing(),padding:{left:20,top:20,right:20,bottom:20},duration:500})},Ge=async g=>{if(!e||!w(e))return;const b=Ft(g.geometry);e.fitBounds(b,{bearing:e.getBearing(),padding:20,duration:500})},Ke=g=>{if(!e||!w(e))return;const b=e.getSprite();b||console.warn("Sprite is not available yet.");const T=b.find(x=>x.id===g);if(T)return T.url;console.warn(`Sprite with id ${g} not found.`)},re=()=>{if(!e||!w(e))return console.warn("Map is not ready yet."),[0,0,0,0];const g=D=>Math.max(Ct,Math.min(xt,D)),b=D=>(D=D%360,D>180?D-=360:D<-180&&(D+=360),D),T=e.getBounds(),x=g(T._sw.lat),W=g(T._ne.lat);let $=b(T._sw.lng),v=b(T._ne.lng);return $>v&&($=Lt,v=Mt),[$,x,v,W]},ge=()=>{if(!e||!w(e)){console.warn("Map is not ready yet.");return}const g=e.getStyle(),b={...g.sources},T=[...g.layers];for(const x of T)e.getLayer(x.id)&&e.removeLayer(x.id);for(const x in b)e.getSource(x)&&e.removeSource(x);for(const[x,W]of Object.entries(b))e.addSource(x,W);for(const x of T)e.addLayer(x);R(He)&&e.setTerrain({source:"terrain",exaggeration:1})},Qe=()=>{!e||!w(e)||(e.setTerrain(null),e.removeSource("terrain"),e.setTerrain({source:"terrain",exaggeration:1}),e.getBounds().toArray(),e.getZoom(),ge(),Z())},et=g=>{if(!e||!w(e))return;const b=e.getCanvas();b&&(b.style.cursor=g)},O=g=>b=>g.subscribe(T=>{T&&b(T)});return{subscribe:t,init:A,isInitialized:()=>R(d),remove:()=>{!e||!w(e)||(e.remove(),e=null,n(null),a.set(null),l.set(null),u.set(null),i.set(null),f.set(null),J.set(!0),h.set(null),y.set(null),c.set(null),d.set(null),m.set(null),r=null)},addLockonMarker:I,removeLockonMarker:ee,queryRenderedFeatures:Fe,setCursor:et,setData:(g,b)=>{if(!e||!w(e))return;const T=e.getSource(g);T?T.setData(b):console.warn(`Source with ID ${g} does not exist.`)},setStyle:P,setFilter:k,setLayoutProperty:(g,b,T,x)=>{if(!(!e||!w(e)))try{e.getLayer(g)?e.setLayoutProperty(g,b,T,x):console.warn(`Layer with ID ${g} does not exist.`)}catch(W){console.error(`Error setting layout property for layer ${g}:`,W)}},setBearing:g=>e==null?void 0:e.setBearing(g),fitBounds:(g,b)=>{!e||!w(e)||e.fitBounds(g,b)},panTo:Ve,panToPoi:Xe,flyTo:(g,b)=>{!e||!w(e)||e.flyTo({center:g,...b})},easeTo:g=>Je(g),focusLayer:Ye,focusFeature:Ge,jumpToFac:K,terrainReload:Z,toggleTerrain:te,resetDem:Qe,resetAllSourcesAndLayers:ge,getLockonMarker:()=>r,getMap:()=>e,getZoom:()=>e==null?void 0:e.getZoom(),getCenter:()=>e==null?void 0:e.getCenter(),getPitch:()=>e==null?void 0:e.getPitch(),getBearing:()=>e==null?void 0:e.getBearing(),getTerrain:()=>e==null?void 0:e.getTerrain(),getLayer:g=>{if(!(!e||!w(e)))return e.getLayer(g)},getState:()=>R(o),getImage:g=>e==null?void 0:e.getImage(g),getMapBounds:re,getSpriteUrl:Ke,getCanvas:()=>e==null?void 0:e.getCanvas(),getMapContainer:Q,onSetStyle:O(f),onResize:O(c),onload:O(m),onClick:O(s),onMouseover:O(a),onMouseout:O(l),onRotate:O(u),onZoom:O(i),onMooveEnd:O(y),onLoading:O(J),onInitialized:O(d),onStyleLoad:O(h),onStateChange:o.subscribe}},gn=Or(),mn=M(!1),pn=M(-1),yn=()=>window.innerWidth>St,wn=(r,e)=>{let t;if(e==="color"?t="bxs:color-fill":e==="number"?t="lsicon:number-filled":t="bxs:color-fill",!r)return t;switch(r){case"match":return"material-symbols:category-rounded";case"step":return"subway:step-1";case"linear":return"mdi:graph-bell-curve-cumulative";default:return t}};class Br extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}function bn(r,{signal:e}={}){return new Promise((t,n)=>{const o=()=>{n(new Br)},s=()=>{clearTimeout(a),o()};if(e!=null&&e.aborted)return o();const a=setTimeout(()=>{e==null||e.removeEventListener("abort",s),t()},r);e==null||e.addEventListener("abort",s,{once:!0})})}export{hn as C,lr as D,le as T,sn as a,gr as b,Ze as c,bn as d,mn as e,Ft as f,wn as g,Xr as h,yn as i,Ir as j,He as k,br as l,gn as m,cn as n,un as o,Ht as p,nn as q,on as r,Jr as s,pn as t,an as u,ln as v,Y as x};
