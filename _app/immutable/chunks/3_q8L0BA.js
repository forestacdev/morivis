var Qe=Object.defineProperty;var et=(r,e,t)=>e in r?Qe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var T=(r,e,t)=>et(r,typeof e!="symbol"?e+"":e,t);import{i as tt,E as rt,j as nt,w as ot,au as st,h as at,l as it}from"./DoYK5enb.js";import{d as ct,w as S,g as R}from"./D_xYOuR_.js";import{m as N}from"./CWzhDz5V.js";import{g as lt,M as ut,j as ht,C as dt,D as ft,W as gt,k as mt,l as pt,m as yt,n as wt}from"./Ck6o1zTe.js";import{s as bt,g as vt}from"./DANrnPG8.js";function zr(r,e,...t){var n=r,o=ot,s;tt(()=>{o!==(o=e())&&(s&&(st(s),s=null),s=nt(()=>o(n,...t)))},rt),at&&(n=it)}var Et=Object.defineProperty,Z=Math.pow,E=(r,e)=>Et(r,"name",{value:e,configurable:!0}),M=(r,e,t)=>new Promise((n,o)=>{var s=h=>{try{l(t.next(h))}catch(i){o(i)}},a=h=>{try{l(t.throw(h))}catch(i){o(i)}},l=h=>h.done?n(h.value):Promise.resolve(h.value).then(s,a);l((t=t.apply(r,e)).next())});E((r,e)=>{let t=!1,n="",o=L.GridLayer.extend({createTile:E((s,a)=>{let l=document.createElement("img"),h=new AbortController,i=h.signal;return l.cancel=()=>{h.abort()},t||(r.getHeader().then(m=>{m.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):m.tileType===2?n="image/png":m.tileType===3?n="image/jpeg":m.tileType===4?n="image/webp":m.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(s.z,s.x,s.y,i).then(m=>{if(m){let d=new Blob([m.data],{type:n}),p=window.URL.createObjectURL(d);l.src=p,l.cancel=void 0,a(void 0,l)}}).catch(m=>{if(m.name!=="AbortError")throw m}),l},"createTile"),_removeTile:E(function(s){let a=this._tiles[s];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[s],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new o(e)},"leafletRasterLayer");var At=E(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(o=>t(void 0,o.data,o.cacheControl||"",o.expires||""),o=>t(o)).catch(o=>t(o)),{cancel:E(()=>n.abort(),"cancel")}},"v3compat"),Ce=class{constructor(e){this.tilev4=E((t,n)=>M(this,null,function*(){if(t.type==="json"){let y=t.url.substr(10),c=this.tiles.get(y);if(c||(c=new X(y),this.tiles.set(y,c)),this.metadata)return{data:yield c.getTileJson(t.url)};let u=yield c.getHeader();return(u.minLon>=u.maxLon||u.minLat>=u.maxLat)&&console.error(`Bounds of PMTiles archive ${u.minLon},${u.minLat},${u.maxLon},${u.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:u.minZoom,maxzoom:u.maxZoom,bounds:[u.minLon,u.minLat,u.maxLon,u.maxLat]}}}let o=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(o);if(!s)throw new Error("Invalid PMTiles protocol URL");let a=s[1],l=this.tiles.get(a);l||(l=new X(a),this.tiles.set(a,l));let h=s[2],i=s[3],m=s[4],d=yield l.getHeader(),p=yield l==null?void 0:l.getZxy(+h,+i,+m,n.signal);if(p)return{data:new Uint8Array(p.data),cacheControl:p.cacheControl,expires:p.expires};if(d.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=At(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};E(Ce,"Protocol");var Ct=Ce;function Pe(r,e){return(e>>>0)*4294967296+(r>>>0)}E(Pe,"toNum");function Te(r,e){let t=e.buf,n=t[e.pos++],o=(n&112)>>4;if(n<128||(n=t[e.pos++],o|=(n&127)<<3,n<128)||(n=t[e.pos++],o|=(n&127)<<10,n<128)||(n=t[e.pos++],o|=(n&127)<<17,n<128)||(n=t[e.pos++],o|=(n&127)<<24,n<128)||(n=t[e.pos++],o|=(n&1)<<31,n<128))return Pe(r,o);throw new Error("Expected varint not more than 10 bytes")}E(Te,"readVarintRemainder");function j(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,Te(n,r))}E(j,"readVarint");function ie(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let o=e[0];e[0]=e[1],e[1]=o}}E(ie,"rotate");function xe(r,e){let t=Z(2,r),n=e,o=e,s=e,a=[0,0],l=1;for(;l<t;)n=1&s/2,o=1&(s^n),ie(l,a,n,o),a[0]+=l*n,a[1]+=l*o,s=s/4,l*=2;return[r,a[0],a[1]]}E(xe,"idOnLevel");var Pt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Le(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>Z(2,r)-1||t>Z(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=Pt[r],o=Z(2,r),s=0,a=0,l=0,h=[e,t],i=o/2;for(;i>0;)s=(h[0]&i)>0?1:0,a=(h[1]&i)>0?1:0,l+=i*i*(3*s^a),ie(i,h,s,a),i=i/2;return n+l}E(Le,"zxyToTileId");function Tt(r){let e=0;for(let t=0;t<27;t++){let n=(1<<t)*(1<<t);if(e+n>r)return xe(t,r-e);e+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}E(Tt,"tileIdToZxy");var xt=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(xt||{});function G(r,e){return M(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return lt(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}E(G,"defaultDecompress");var Lt=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Lt||{});function Se(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}E(Se,"tileTypeExt");var St=127;function Me(r,e){let t=0,n=r.length-1;for(;t<=n;){let o=n+t>>1,s=e-r[o].tileId;if(s>0)t=o+1;else if(s<0)n=o-1;else return r[o]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}E(Me,"findTile");var Mt=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return M(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};E(Mt,"FileSource");var ke=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let o=n.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,o&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,o){return M(this,null,function*(){let s,a;n?a=n:(s=new AbortController,a=s.signal);let l=new Headers(this.customHeaders);l.set("range",`bytes=${e}-${e+t-1}`);let h;this.mustReload?h="reload":this.chromeWindowsNoCache&&(h="no-store");let i=yield fetch(this.url,{signal:a,cache:h,headers:l});if(e===0&&i.status===416){let p=i.headers.get("Content-Range");if(!p||!p.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let y=+p.substr(8);i=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let m=i.headers.get("Etag");if(m!=null&&m.startsWith("W/")&&(m=null),i.status===416||o&&m&&m!==o)throw this.mustReload=!0,new se(`Server returned non-matching ETag ${o} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(i.status>=300)throw new Error(`Bad response code: ${i.status}`);let d=i.headers.get("Content-Length");if(i.status===200&&(!d||+d>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield i.arrayBuffer(),etag:m||void 0,cacheControl:i.headers.get("Cache-Control")||void 0,expires:i.headers.get("Expires")||void 0}})}};E(ke,"FetchSource");var kt=ke;function B(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Z(2,32)+n}E(B,"getUint64");function Re(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:B(t,8),rootDirectoryLength:B(t,16),jsonMetadataOffset:B(t,24),jsonMetadataLength:B(t,32),leafDirectoryOffset:B(t,40),leafDirectoryLength:B(t,48),tileDataOffset:B(t,56),tileDataLength:B(t,64),numAddressedTiles:B(t,72),numTileEntries:B(t,80),numTileContents:B(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}E(Re,"bytesToHeader");function ce(r){let e={buf:new Uint8Array(r),pos:0},t=j(e),n=[],o=0;for(let s=0;s<t;s++){let a=j(e);n.push({tileId:o+a,offset:0,length:0,runLength:1}),o+=a}for(let s=0;s<t;s++)n[s].runLength=j(e);for(let s=0;s<t;s++)n[s].length=j(e);for(let s=0;s<t;s++){let a=j(e);a===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=a-1}return n}E(ce,"deserializeIndex");var Ie=class extends Error{};E(Ie,"EtagMismatch");var se=Ie;function le(r,e){return M(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,St),o=Re(n,t.etag),s=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,l=ce(yield e(s,o.internalCompression));return[o,[a,l.length,l]]})}E(le,"getHeaderAndRoot");function ue(r,e,t,n,o){return M(this,null,function*(){let s=yield r.getBytes(t,n,void 0,o.etag),a=yield e(s.data,o.internalCompression),l=ce(a);if(l.length===0)throw new Error("Empty directory is invalid");return l})}E(ue,"getDirectory");var Rt=class{constructor(e=100,t=!0,n=G){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return M(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let o=yield le(e,this.decompress);return o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:o[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:o[0]}),this.prune(),o[0]})}getDirectory(e,t,n,o){return M(this,null,function*(){let s=`${e.getKey()}|${o.etag||""}|${t}|${n}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,a.data;let l=yield ue(e,this.decompress,t,n,o);return this.cache.set(s,{lastUsed:this.counter++,data:l}),this.prune(),l})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,o)=>{n.lastUsed<e&&(e=n.lastUsed,t=o)}),t&&this.cache.delete(t)}}invalidate(e){return M(this,null,function*(){this.cache.delete(e.getKey())})}};E(Rt,"ResolvedValueCache");var Oe=class{constructor(e=100,t=!0,n=G){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return M(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let o=new Promise((s,a)=>{le(e,this.decompress).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{a(l)})});return this.cache.set(t,{lastUsed:this.counter++,data:o}),o})}getDirectory(e,t,n,o){return M(this,null,function*(){let s=`${e.getKey()}|${o.etag||""}|${t}|${n}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,yield a.data;let l=new Promise((h,i)=>{ue(e,this.decompress,t,n,o).then(m=>{h(m),this.prune()}).catch(m=>{i(m)})});return this.cache.set(s,{lastUsed:this.counter++,data:l}),l})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,o)=>{n.lastUsed<e&&(e=n.lastUsed,t=o)}),t&&this.cache.delete(t)}}invalidate(e){return M(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((o,s)=>{this.getHeader(e).then(a=>{o(),this.invalidations.delete(t)}).catch(a=>{s(a)})});this.invalidations.set(t,n)})}};E(Oe,"SharedPromiseCache");var It=Oe,Be=class{constructor(e,t,n){typeof e=="string"?this.source=new kt(e):this.source=e,n?this.decompress=n:this.decompress=G,t?this.cache=t:this.cache=new It}getHeader(){return M(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,o){return M(this,null,function*(){let s=Le(e,t,n),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let l=a.rootDirectoryOffset,h=a.rootDirectoryLength;for(let i=0;i<=3;i++){let m=yield this.cache.getDirectory(this.source,l,h,a),d=Me(m,s);if(d){if(d.runLength>0){let p=yield this.source.getBytes(a.tileDataOffset+d.offset,d.length,o,a.etag);return{data:yield this.decompress(p.data,a.tileCompression),cacheControl:p.cacheControl,expires:p.expires}}l=a.leafDirectoryOffset+d.offset,h=d.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,o){return M(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,o)}catch(s){if(s instanceof se)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,o);throw s}})}getMetadataAttempt(){return M(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),o=new TextDecoder("utf-8");return JSON.parse(o.decode(n))})}getMetadata(){return M(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof se)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return M(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),o=Se(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${o}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};E(Be,"PMTiles");var X=Be;function De(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Hr(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fe(r[0])||!fe(r[1]))throw new Error("coordinates must contain numbers");return De({type:"Point",coordinates:r},e,t)}function Ot(r,e,t={}){for(const o of r){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return De({type:"Polygon",coordinates:r},e,t)}function Vr(r){return r%(2*Math.PI)*180/Math.PI}function Jr(r){return r%360*Math.PI/180}function fe(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ue(r,e,t){if(r!==null)for(var n,o,s,a,l,h,i,m=0,d=0,p,y=r.type,c=y==="FeatureCollection",u=y==="Feature",g=c?r.features.length:1,A=0;A<g;A++){i=c?r.features[A].geometry:u?r.geometry:r,p=i?i.type==="GeometryCollection":!1,l=p?i.geometries.length:1;for(var w=0;w<l;w++){var C=0,k=0;if(a=p?i.geometries[w]:i,a!==null){h=a.coordinates;var I=a.type;switch(m=0,I){case null:break;case"Point":if(e(h,d,A,C,k)===!1)return!1;d++,C++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(e(h[n],d,A,C,k)===!1)return!1;d++,I==="MultiPoint"&&C++}I==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(o=0;o<h[n].length-m;o++){if(e(h[n][o],d,A,C,k)===!1)return!1;d++}I==="MultiLineString"&&C++,I==="Polygon"&&k++}I==="Polygon"&&C++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(k=0,o=0;o<h[n].length;o++){for(s=0;s<h[n][o].length-m;s++){if(e(h[n][o][s],d,A,C,k)===!1)return!1;d++}k++}C++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(Ue(a.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Bt(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Ue(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Dt=Bt;const Ut=()=>{const r=bt;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},qt={subscribe(r){return Ut().page.subscribe(r)}};let F=String.fromCharCode,qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",H={};function zt(r,e){if(!H[r]){H[r]={};for(let t=0;t<r.length;t++)H[r][r.charAt(t)]=t}return H[r][e]}function Wt(r){return r==null?"":Nt(r,6,function(e){return qe.charAt(e)})}function jt(r){return r==null?"":r==""?null:$t((r=r.replace(/ /g,"+")).length,32,function(e){return zt(qe,r.charAt(e))})}function Nt(r,e,t){if(r==null)return"";let n,o,s={},a={},l="",h="",i="",m=2,d=3,p=2,y=[],c=0,u=0,g;for(g=0;g<r.length;g+=1)if(l=r.charAt(g),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=d++,a[l]=!0),h=i+l,Object.prototype.hasOwnProperty.call(s,h))i=h;else{if(Object.prototype.hasOwnProperty.call(a,i)){if(256>i.charCodeAt(0)){for(n=0;n<p;n++)c<<=1,u==e-1?(u=0,y.push(t(c)),c=0):u++;for(n=0,o=i.charCodeAt(0);n<8;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}else{for(n=0,o=1;n<p;n++)c=c<<1|o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o=0;for(n=0,o=i.charCodeAt(0);n<16;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}--m==0&&(m=Math.pow(2,p),p++),delete a[i]}else for(n=0,o=s[i];n<p;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1;--m==0&&(m=Math.pow(2,p),p++),s[h]=d++,i=String(l)}if(i!==""){if(Object.prototype.hasOwnProperty.call(a,i)){if(256>i.charCodeAt(0)){for(n=0;n<p;n++)c<<=1,u==e-1?(u=0,y.push(t(c)),c=0):u++;for(n=0,o=i.charCodeAt(0);n<8;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}else{for(n=0,o=1;n<p;n++)c=c<<1|o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o=0;for(n=0,o=i.charCodeAt(0);n<16;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1}--m==0&&(m=Math.pow(2,p),p++),delete a[i]}else for(n=0,o=s[i];n<p;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1;--m==0&&(m=Math.pow(2,p),p++)}for(n=0,o=2;n<p;n++)c=c<<1|1&o,u==e-1?(u=0,y.push(t(c)),c=0):u++,o>>=1;for(;;){if(c<<=1,u==e-1){y.push(t(c));break}u++}return y.join("")}function $t(r,e,t){let n=[],o=4,s=4,a=3,l="",h=[],i,m,d,p,y,c,u,g={val:t(0),position:e,index:1};for(i=0;i<3;i+=1)n[i]=i;for(d=0,y=4,c=1;c!=y;)p=g.val&g.position,g.position>>=1,g.position==0&&(g.position=e,g.val=t(g.index++)),d|=(p>0?1:0)*c,c<<=1;switch(d){case 0:for(d=0,y=256,c=1;c!=y;)p=g.val&g.position,g.position>>=1,g.position==0&&(g.position=e,g.val=t(g.index++)),d|=(p>0?1:0)*c,c<<=1;u=F(d);break;case 1:for(d=0,y=65536,c=1;c!=y;)p=g.val&g.position,g.position>>=1,g.position==0&&(g.position=e,g.val=t(g.index++)),d|=(p>0?1:0)*c,c<<=1;u=F(d);break;case 2:return""}for(n[3]=u,m=u,h.push(u);;){if(g.index>r)return"";for(d=0,y=Math.pow(2,a),c=1;c!=y;)p=g.val&g.position,g.position>>=1,g.position==0&&(g.position=e,g.val=t(g.index++)),d|=(p>0?1:0)*c,c<<=1;switch(u=d){case 0:for(d=0,y=256,c=1;c!=y;)p=g.val&g.position,g.position>>=1,g.position==0&&(g.position=e,g.val=t(g.index++)),d|=(p>0?1:0)*c,c<<=1;n[s++]=F(d),u=s-1,o--;break;case 1:for(d=0,y=65536,c=1;c!=y;)p=g.val&g.position,g.position>>=1,g.position==0&&(g.position=e,g.val=t(g.index++)),d|=(p>0?1:0)*c,c<<=1;n[s++]=F(d),u=s-1,o--;break;case 2:return h.join("")}if(o==0&&(o=Math.pow(2,a),a++),n[u])l=n[u];else{if(u!==s)return null;l=m+m.charAt(0)}h.push(l),n[s++]=m+l.charAt(0),o--,m=l,o==0&&(o=Math.pow(2,a),a++)}}let ze;ze=qt;const Zt={keepFocus:!0,noScroll:!0,replaceState:!0},_t={keepFocus:!0,noScroll:!0,replaceState:!1};function Ft(r,e,t){var s;const n=Array.from(new Set(Array.from(((s=r==null?void 0:r.keys)==null?void 0:s.call(r))||[]).concat(Object.keys(t??{}))));let o=!1;return[Object.fromEntries(n.map(a=>{if(e[a]!=null)return[a,e[a]];let l=d=>d;const h=t==null?void 0:t[a];typeof h!="boolean"&&typeof(h==null?void 0:h.decode)=="function"&&(l=h.decode);const i=r==null?void 0:r.get(a);let m;return i==null&&(h==null?void 0:h.defaultValue)!=null?(m=h.defaultValue,o=!0):m=l(i),[a,m]})),o]}function Ht(r,e,t=(n,o)=>JSON.stringify(n)===JSON.stringify(o)){return typeof r=="object"&&typeof e=="object"&&t(r,e)}function re({encode:r,decode:e}){function t(n){return{encode:r,decode:e,defaultValue:n}}return t}function Vt(r){return{encode:e=>JSON.stringify(e),decode:e=>{if(e===null)return null;try{return JSON.parse(e)}catch{return null}},defaultValue:r}}function Jt(r){return{encode:e=>JSON.stringify(e),decode:e=>{if(e===null)return null;try{return JSON.parse(e)}catch{return null}},defaultValue:r}}function Xt(r){return{encode:e=>Wt(JSON.stringify(e)),decode:e=>{if(!e)return null;try{return JSON.parse(jt(e)??"")}catch{return null}},defaultValue:r}}const V={number:re({encode:r=>r.toString(),decode:r=>r?parseFloat(r):null}),boolean:re({encode:r=>r+"",decode:r=>r!==null&&r!=="false"}),string:re({encode:r=>r??"",decode:r=>r}),object:Vt,array:Jt,lz:Xt},ne=new Set;let ge;const me=new Map;function z(r,{debounceHistory:e=0,pushHistory:t=!0,sort:n=!0,showDefaults:o=!0,equalityFn:s}={}){const a=S({});let l,h=!0;function i(d,p){h=!1;const y=window.location.hash,c=new URLSearchParams(window.location.search),u=g=>{for(const A of Object.keys(d)){if(d[A]==null){g.delete(A);continue}let w=I=>I.toString();const C=r==null?void 0:r[A];typeof C!="boolean"&&typeof(C==null?void 0:C.encode)=="function"&&(w=C.encode);const k=w(d[A]);k==null?g.delete(A):g.set(A,k)}};ne.add(u),clearTimeout(ge),ge=setTimeout(async()=>{ne.forEach(g=>{g(c)}),clearTimeout(me.get("queryParameters"));{a.set(d);async function g(){n&&c.sort(),await vt(`?${c}${y}`,t?_t:Zt),a.set({})}p||e===0?g():me.set("queryParameters",setTimeout(g,e))}ne.clear()})}const{subscribe:m}=ct([ze,a],([d,p],y)=>{var g;const[c,u]=Ft((g=d==null?void 0:d.url)==null?void 0:g.searchParams,p,r);if(u&&o&&i(structuredClone(c),h),!Ht(l,c,s))return l=structuredClone(c),y(structuredClone(c))});return{set(d){i(d)},subscribe:m,update:d=>{const p=R({subscribe:m}),y=d(p);i(y)}}}const Xr=r=>{const e=r.slice(1).split("&"),t={};return e.forEach(n=>{t[n.split("=")[0]]=n.split("=")[1]}),t},Gt=()=>{const r=R(z({c:V.string(),z:V.number(),p:V.number(),b:V.number()},{pushHistory:!1}));if(r.c===null||r.c===void 0||r.z===null||r.z===void 0||r.p===null||r.p===void 0||r.b===null||r.b===void 0)return ut;const e=r.c.split(",").map(Number),t=Number(r.z),n=Number(r.p),o=Number(r.b);return{center:e,zoom:t,pitch:n,bearing:o}},Yt=r=>{const e=R(z({},{pushHistory:!1})),t=r.center.map(n=>n.toFixed(6));e.c=t,e.z=r.zoom.toFixed(1),e.p=r.pitch.toFixed(0),e.b=r.bearing.toFixed(0),R(ht)||(e.imageId="-1"),R(je)||(e["3d"]="0"),z({},{pushHistory:!1}).set(e)},Gr=r=>{const e=R(z({}));e.imageId=r,z({},{pushHistory:!1}).set(e)},pe=r=>{const e=R(z({}));e["3d"]=r,z({},{pushHistory:!1}).set(e)},Yr=()=>R(z({},{pushHistory:!1}))["3d"],Kr=r=>{const e=new URLSearchParams;for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];Array.isArray(n)?n.forEach(o=>{e.append(t,o)}):n!=null&&e.append(t,String(n))}return e.toString()},We={mapbox:0,gsi:1,terrarium:2},Qr=["jet","hsv","hot","spring","summer","autumn","winter","bone","copper","greys","yignbu","greens","yiorrd","bluered","rdbu","picnic","rainbow","portland","blackbody","earth","electric","viridis","inferno","magma","plasma","warm","cool","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red","oxygen","par","phase","salinity","temperature","turbidity","velocity-blue","velocity-green","cubehelix"],Kt={default:0,relief:1,slope:2,aspect:3,curvature:4,shadow:5},U=class U{constructor(e=500){T(this,"imageBaseUrlCache",new Map);T(this,"cache");T(this,"cacheSizeLimit");T(this,"cacheOrder");this.cache=new Map,this.cacheSizeLimit=e,this.cacheOrder=[],this.imageBaseUrlCache=new Map}static getInstance(e=500){return U.instance||(U.instance=new U(e)),U.instance}async loadImagePmtiles(e,t,n){try{let o=U.pmCache.get(e);o||(o=new X(e),U.pmCache.set(e,o));const s=await o.getZxy(t.z,t.x,t.y,n);if(!s||!s.data)throw new Error("Tile data not found");const a=new Blob([s.data],{type:"image/png"});return await createImageBitmap(a)}catch(o){if(o instanceof Error&&o.name==="AbortError")throw o;return await createImageBitmap(new ImageData(1,1))}}async loadImage(e,t){try{const n=await fetch(e,{signal:t});if(!n.ok)throw new Error("Failed to fetch image");return await createImageBitmap(await n.blob())}catch(n){if(n instanceof Error&&n.name==="AbortError")throw n;return await createImageBitmap(new ImageData(1,1))}}async getSingleTileImage(e,t,n,o,s,a,l){const h=s.replace("{x}",t.toString()).replace("{y}",n.toString()).replace("{z}",o.toString());if(this.cache.has(e)){const i=this.cache.get(e);return this.add(e,i),i}try{let i;if(a==="image")i=await this.loadImage(h,l.signal);else if(a==="pmtiles"){const m={x:t,y:n,z:o};i=await this.loadImagePmtiles(h,m,l.signal)}if(!i)throw new Error(`Failed to load image for ${e}`);return this.add(e,i),i}catch(i){if(i instanceof Error&&i.name==="AbortError")throw i;return console.error(`Error in getSingleTileImage for ${e}:`,i),await createImageBitmap(new ImageData(1,1))}}async getAdjacentTilesWithImages(e,t,n,o,s,a,l){const h=[{position:"center",dx:0,dy:0},{position:"left",dx:-1,dy:0},{position:"right",dx:1,dy:0},{position:"top",dx:0,dy:-1},{position:"bottom",dx:0,dy:1}],i={};return await Promise.all(h.map(async({position:m,dx:d,dy:p})=>{const y=t+d,c=n+p,u=`${e}_${y}_${c}_${o}`,A=(this.imageBaseUrlCache.get(e)||s).replace("{x}",y.toString()).replace("{y}",c.toString()).replace("{z}",o.toString());let w=this.cache.get(u);if(!w){if(a==="image")w=await this.loadImage(A,l.signal);else if(a==="pmtiles"){const C={x:y,y:c,z:o};w=await this.loadImagePmtiles(A,C,l.signal)}}w&&(this.add(u,w),i[m]={tileId:u,image:w})})),i}add(e,t){if(this.cacheOrder.length>=this.cacheSizeLimit){const o=this.cacheOrder.shift();o&&this.cache.delete(o)}this.cache.set(e,t);const n=this.cacheOrder.indexOf(e);n>-1&&this.cacheOrder.splice(n,1),this.cacheOrder.push(e)}get(e){return this.cache.get(e)}has(e){return this.cache.has(e)}clear(){this.cache.clear(),this.cacheOrder=[]}getUrlcache(e){return this.imageBaseUrlCache.get(e)}addUrlcache(e,t){this.imageBaseUrlCache.set(e,t)}deleteUrlcache(e){this.imageBaseUrlCache.delete(e)}};T(U,"instance"),T(U,"pmCache",new Map);let ae=U,Qt=class{constructor(e){T(this,"worker");T(this,"pendingRequests");T(this,"tileCache");T(this,"colorMapCache");T(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data,s=this.pendingRequests.get(t);o?(console.error(`Error processing tile ${t}:`,o),s&&(s.reject(new Error(o)),this.pendingRequests.delete(t))):s&&(s.resolve({data:n}),this.pendingRequests.delete(t))});this.worker=e,this.pendingRequests=new Map,this.tileCache=ae.getInstance(),this.colorMapCache=new dt,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),a=e.searchParams.get("entryId")||"",l=e.origin+e.pathname,h=`${a}_${n}_${o}_${s}`,i=e.searchParams.get("formatType"),m=e.searchParams.get("demType"),d=We[m],p=e.searchParams.get("mode")||"default",y=Kt[p],c="buffar";if(p==="relief"){const u=await this.tileCache.getSingleTileImage(h,n,o,s,l,i,t),g=this.colorMapCache.createColorArray(e.searchParams.get("colorMap")||"bone"),A=parseFloat(e.searchParams.get("max")||"10000"),w=parseFloat(e.searchParams.get("min")||"0");return new Promise((C,k)=>{this.pendingRequests.set(h,{resolve:C,reject:k,controller:t}),this.worker.postMessage({tileId:h,center:u,demTypeNumber:d,modeNumber:y,mode:p,elevationColorArray:g,max:A,min:w,encodeType:c})})}else{const u=await this.tileCache.getAdjacentTilesWithImages(a,n,o,s,l,i,t),g=this.colorMapCache.createColorArray(e.searchParams.get("colorMap")||"bone"),A=u.center,w=A.tileId,C=u.left,k=u.right,I=u.top,Y=u.bottom,K=parseFloat(e.searchParams.get("max")||"90"),Q=parseFloat(e.searchParams.get("min")||"0");return new Promise((_,ee)=>{this.pendingRequests.set(w,{resolve:_,reject:ee,controller:t}),this.worker.postMessage({tileId:w,center:A.image,left:C.image,right:k.image,top:I.image,bottom:Y.image,demTypeNumber:d,modeNumber:y,mode:p,elevationColorArray:g,max:K,min:Q,tile:{x:n,y:o,z:s},encodeType:c})})}}handleError(e){console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()}cancelAllRequests(){this.pendingRequests.size>0&&this.pendingRequests.forEach(({reject:e,controller:t})=>{t.abort(),e(new Error("Request cancelled"))}),console.info("All requests have been cancelled."),this.pendingRequests.clear()}clearCache(){this.tileCache.clear()}};class er{constructor(e){T(this,"workers",[]);T(this,"workerIndex",0);T(this,"poolSize");this.poolSize=e;for(let t=0;t<e;t++){const n=new Worker(new URL(""+new URL("../workers/worker-Dr9vdl9S.js",import.meta.url).href,import.meta.url),{type:"module"});this.workers.push(new Qt(n))}}getNextWorker(){const e=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.poolSize,e}async request(e,t){return this.getNextWorker().request(e,t)}cancelAllRequests(){this.workers.forEach(e=>e.cancelAllRequests())}clearCache(){this.workers.forEach(e=>e.clearCache())}}const oe=new er(2),tr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return oe.request(o,t)},cancelAllRequests:()=>oe.cancelAllRequests(),clearCache:()=>oe.clearCache()}),rr=180/Math.PI;function ye(r,e){return r/Math.pow(2,e)*360-180}function we(r,e){const t=Math.PI-2*Math.PI*r/Math.pow(2,e);return rr*Math.atan(.5*(Math.exp(t)-Math.exp(-t)))}function nr(r){const e=ye(r[0]+1,r[2]),t=ye(r[0],r[2]),n=we(r[1]+1,r[2]),o=we(r[1],r[2]);return[t,n,e,o]}function or(r){return[[r[0]*2,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2,r[2]+1],[r[0]*2+1,r[1]*2+1,r[2]+1],[r[0]*2,r[1]*2+1,r[2]+1]]}function sr(r){return[r[0]>>1,r[1]>>1,r[2]-1]}function ar(r){return or(sr(r))}function ir(r,e={}){const t=Number(r[0]),n=Number(r[1]),o=Number(r[2]),s=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const a=[t,n];return Ot([[a,[o,n],[o,s],[t,s],a]],e.properties,{bbox:r,id:e.id})}var cr=ir;let lr=class{constructor(e){T(this,"worker");T(this,"pendingRequests");T(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data;if(o){const s=this.pendingRequests.get(t);s&&(s.resolve({data:new Uint8Array}),this.pendingRequests.delete(t))}else{const s=this.pendingRequests.get(t);s&&(s.resolve({data:n}),this.pendingRequests.delete(t))}});T(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){try{const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),l={type:"FeatureCollection",features:ar([n,o,s]).map(m=>{const[d,p,y]=m,c=nr([d,p,y]);return{...cr(c),properties:{x:n,y:o,z:s,index:`${y}/${d}/${p}`}}})},{signal:h}=t,i=`${s}/${n}/${o}_tile_index`;return new Promise((m,d)=>{this.pendingRequests.set(i,{resolve:m,reject:d}),h.addEventListener("abort",()=>{this.pendingRequests.delete(i),d(new Error("Request aborted"))}),this.worker.postMessage({id:i,z:s,x:n,y:o,geojson:l})})}catch(n){return Promise.reject(n)}}};const ur=new Worker(new URL(""+new URL("../workers/worker-DfC3PjOV.js",import.meta.url).href,import.meta.url),{type:"module"}),hr=new lr(ur),dr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return hr.request(o,t)}}),be=new Map,fr=async(r,e,t)=>{try{let n=be.get(r);n||(n=new X(r),be.set(r,n));const o=await n.getZxy(e.z,e.x,e.y,t);if(!o||!o.data)throw new Error("Tile data not found");const s=new Blob([o.data],{type:"image/png"});return await createImageBitmap(s)}catch(n){if(n instanceof Error&&n.name==="AbortError")throw new Error("Request aborted");return await createImageBitmap(new ImageData(1,1))}},gr=async(r,e)=>{try{const t=await fetch(r,{signal:e});if(!t.ok)throw new Error("Failed to fetch image");return await createImageBitmap(await t.blob())}catch(t){if(t instanceof Error&&t.name==="AbortError")throw new Error("Request aborted");return await createImageBitmap(new ImageData(1,1))}};class mr{constructor(e){T(this,"worker");T(this,"pendingRequests");T(this,"handleMessage",e=>{const{id:t,buffer:n,error:o}=e.data,s=this.pendingRequests.get(t);o?(console.error(`Error processing tile ${t}:`,o),s&&(s.reject(new Error(o)),this.pendingRequests.delete(t))):s&&(s.resolve({data:n}),this.pendingRequests.delete(t))});T(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(t=>{t.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,t){try{const n=parseInt(e.searchParams.get("x")||"0",10),o=parseInt(e.searchParams.get("y")||"0",10),s=parseInt(e.searchParams.get("z")||"0",10),a=e.origin+e.pathname,l=e.searchParams.get("entryId")||"",h=`${a}_${l}_${n}_${o}_${s}`,i=e.searchParams.get("formatType")||"image",m=e.searchParams.get("demType")||"mapbox";let d;return i==="pmtiles"?d=await fr(a,{x:n,y:o,z:s},t.signal):i==="image"&&(d=await gr(a,t.signal)),new Promise((p,y)=>{const c=We[m];this.pendingRequests.set(h,{resolve:p,reject:y,controller:t}),this.worker.postMessage({image:d,demTypeNumber:c,id:h}),t.signal.addEventListener("abort",()=>{this.pendingRequests.delete(h),y(new Error("Request aborted"))})})}catch(n){return Promise.reject(n)}}}const pr=new Worker(new URL(""+new URL("../workers/worker-qG8lXCev.js",import.meta.url).href,import.meta.url),{type:"module"}),yr=new mr(pr),wr=r=>({protocolName:r,request:(e,t)=>{const n=e.url.replace(`${r}://`,""),o=new URL(n);return yr.request(o,t)}}),br="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAkCAYAAAB4+EEtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQLSURBVHgBrVdLbxNXFD537jySMDGD826bKolUxAIa/4BKnbAKQlW74AfEakGqhARdQoSIF5QsqVSpElnU3XdBgAUbiNmxY0AIifeQBOKAkzjx+zXDPZc4msS+40nIJyW277k+n893zj33DIEWiEz9a4BannBdOgrEMcEFgy0bn63EAuLaxIVZkJSEdSFq+/kifiSOVj0nSdJ5pdMw5I4QyLoORKJAqMz31Ip59leAanYDyukVtiLFmT0mIm1K9v309XMSoVNauM/Qunq3nPvBKZc4YfHDe5s5jVmTZ+I799AGoqszl6msTXcOH2lTQodYJBIEAf4g+UAnqEaXUcms/9J7/CQs3711X0iGRLLWPtU5coSlQIW9AElVoxuqmXWzZ+zENsItssiV6xOSol1DoiCy+RIyNdSDYaisr5r9YyfWk3dvP+DrnOjqP0Os2uZC3x0bklQN9guYx8zrp2koSMPWVDTNE+I69HJbz1f7SoRAf1hkoJTP42fCo3Lom9DhY+BH1t+hwqmRXhgfDIOuUEjmy2ClshB/vsTfi+DWarDx4jGPTgaHmqyCfInGB7vg7NGvOYmXfPzbMPwwcBD+frIIdxZWm36XUAqKbhiVWmpCcgn8LOsh8ItoJ5EXuH726Dd8nwjyAeafdSAJXDJE29qFGycODwiJvISnRnp8yHTW5RyTFYgboW0dwo2Rbh2CAKUWYfMoGS3bg588XvhFj3mrk6WxYkTIVsQ2L1pVJPJIQIiF3VuEOwsrEATWSkZoQ/+E8UjEde5XNtLCjf+//tgyOrTHnyWF9vJaiv13ZiWoqNfK6RSIpER58ByJCHEd7X4yVvNZljj1Bk0mZot9x38yWZhDeEU0w8uNAtx7v8aLQFdk/ookN9+mYNqaZxJmhUR4x1XWVuPWxV//4zVJahArrSybWldfvXKaRjj9cB52C3aZsiZJY/iel7516XTCdZwEN+wjMCq3XInXx4Stc0ZINcqiS/tV5m6A1wv78el6VNvIrAu/s9nB/Su/aMN+AFVyS8Vtw0/DwDN6ZeYhG3Ii7QODsFegfPnFN/ajyTPD3vWGdsWi43JWcxnYCzblY6OBMrbT1kDGRjCLuCSWf2eDXxsTYVO+P5rNjsIhdfTPmTkt3GvuRk6mCBSX3sWtyd+izezCrs+rc3XZxu4SBChfYWnB9lZfYDJenTUSZQ64o1ZEWfs5exQgUb953/cKTs7dsvt/PElYbzO1sPgmxuPi5LIx61LjyO0FgQDwyx8WROnjUsK6eHqslZ9Ag3w9fzuPA37GBwkgcjSIn0Bk9fzl5l9u5Q9f8Xi0ypMXFAKinr9aqWCqh7ohN/8KnHyuZZ68CJQzLzB/codu1vLZQHn6YrAnngjsAZ8Atlzok2bc1twAAAAASUVORK5CYII=",vr=new Ct;N.addProtocol("pmtiles",vr.tile);const ve=tr("webgl");N.addProtocol(ve.protocolName,ve.request);const Ee=wr("terrain");N.addProtocol(Ee.protocolName,Ee.request);const Ae=dr("tile_index");N.addProtocol(Ae.protocolName,Ae.request);const Er=S(!1),J=S(!0),je=S(!1),Ar=()=>{let r=null,e=null;const{subscribe:t,set:n}=S(null),o=S({bbox:[0,0,0,0],zoom:0,center:[0,0],pitch:0,bearing:0}),s=S(null),a=S(null),l=S(null),h=S(null),i=S(null),m=S(null),d=S(null),p=S(null),y=S(null),c=S(null),u=S(null),g=S(null),A=(f,b)=>{const P=Gt();if(e=new N.Map({...P,minZoom:2,container:f,centerClampedToGround:!0,style:b,fadeDuration:0,attributionControl:!1,localIdeographFontFamily:!1,maxPitch:85}),R(ft)&&e.on("data",v=>{}),m.set(b),!e)return;const x=16,W=4,$=new Uint8Array(x*x*W);e.addImage("poi-icon",{width:x,height:x,data:$}),fetch(br,{mode:"cors"}).then(async v=>{if(!v.ok)throw new Error(`Failed to fetch image: ${v.statusText}`);const q=await createImageBitmap(await v.blob());e&&e.addImage("marker_png",q)}),e.once("style.load",()=>{d.set(e)}),e.on("styledata",v=>{e&&(o.set({bbox:te(),zoom:e.getZoom(),center:[e.getCenter().lng,e.getCenter().lat],pitch:e.getPitch(),bearing:e.getBearing()}),p.set(v))}),e.on("load",v=>{g.set(v)}),e.on("click",v=>{R(Er)||s.set(v)}),e.on("resize",v=>{c.set(v)}),e.on("data",v=>{J.set(!0)}),e.on("idle",v=>{J.set(!1)}),e.on("rotate",v=>{if(!e)return;const q=e.getBearing();h.set(q)}),e.on("mousedown",v=>{}),e.on("mouseup",v=>{}),e.on("mouseover",v=>{a.set(v)}),e.on("mouseout",v=>{l.set(v)}),e.on("moveend",v=>{if(!e)return;const q=window.location.href,D=window.location.origin,Ge=e.getZoom(),de=e.getCenter(),Ye=e.getBearing(),Ke=e.getPitch();q.startsWith(`${D}/map`)&&Yt({center:[de.lng,de.lat],zoom:Ge,pitch:Ke,bearing:Ye}),o.set({bbox:te(),zoom:e.getZoom(),center:[e.getCenter().lng,e.getCenter().lat],pitch:e.getPitch(),bearing:e.getBearing()}),y.set(v)}),e.on("zoom",v=>{if(!e)return;const q=e.getZoom();i.set(q)}),u.set(e)},w=f=>f&&typeof f=="object"&&typeof f.getLayer=="function"&&typeof f.setLayoutProperty=="function"&&!f._removed,C=f=>{!e||!w(e)||(m.set(f),e.setStyle(f))},k=(f,b)=>{if(!e||!w(e))return;e.getLayer(f)?e.setFilter(f,b):console.warn(`Layer with ID ${f} does not exist.`)},I=(f,b)=>{!e||!w(e)||(r=new N.Marker({element:f}).setLngLat(b).addTo(e))},Y=()=>{if(!e||!w(e))return;const f=[136.91278,35.543576,136.92986,35.556704];e.fitBounds(f,{padding:20,bearing:e.getBearing(),duration:1e3,animate:!0})},K=async()=>{if(!e||!w(e))return;const f=e.getCanvasContainer(),b=f.clientWidth,P=f.clientHeight;return{canvas:f,witdh:b,height:P}},Q=()=>{!e||!w(e)||r&&r.remove()},_=()=>{!e||!w(e)||e.getTerrain()&&setTimeout(()=>{e&&e.terrain.sourceCache.sourceCache.reload()},200)},ee=f=>{if(!(!e||!w(e)))try{f?e.getSource("terrain")&&(e.setTerrain({source:"terrain",exaggeration:1}),pe("1")):(e.getTerrain()&&e.setTerrain(null),pe("0"))}catch(b){console.error("Terrain control error:",b)}},Ne=(f,b)=>e==null?void 0:e.queryRenderedFeatures(f,b),$e=(f,b)=>{!e||!w(e)||e.panTo(f,b)},Ze=f=>{!e||!w(e)||e.panTo(f,{duration:300})},_e=f=>{!e||!w(e)||e.easeTo(f)},Fe=async f=>{if(!(!e||!w(e)))if(f.metaData.center){e.easeTo({center:f.metaData.center,zoom:f.metaData.minZoom+1.5,bearing:e.getBearing(),pitch:e.getPitch(),padding:{left:20,top:20,right:20,bottom:20},duration:500});return}else e.fitBounds(f.metaData.bounds,{bearing:e.getBearing(),padding:{left:20,top:20,right:20,bottom:20},duration:500})},He=async f=>{if(!e||!w(e))return;const b=Dt(f.geometry);e.fitBounds(b,{bearing:e.getBearing(),padding:20,duration:500})},Ve=f=>{if(!e||!w(e))return;const b=e.getSprite();b||console.warn("Sprite is not available yet.");const P=b.find(x=>x.id===f);if(P)return P.url;console.warn(`Sprite with id ${f} not found.`)},te=()=>{if(!e||!w(e))return console.warn("Map is not ready yet."),[0,0,0,0];const f=D=>Math.max(gt,Math.min(mt,D)),b=D=>(D=D%360,D>180?D-=360:D<-180&&(D+=360),D),P=e.getBounds(),x=f(P._sw.lat),W=f(P._ne.lat);let $=b(P._sw.lng),v=b(P._ne.lng);return $>v&&($=pt,v=yt),[$,x,v,W]},he=()=>{if(!e||!w(e)){console.warn("Map is not ready yet.");return}const f=e.getStyle(),b={...f.sources},P=[...f.layers];for(const x of P)e.getLayer(x.id)&&e.removeLayer(x.id);for(const x in b)e.getSource(x)&&e.removeSource(x);for(const[x,W]of Object.entries(b))e.addSource(x,W);for(const x of P)e.addLayer(x);R(je)&&e.setTerrain({source:"terrain",exaggeration:1})},Je=()=>{!e||!w(e)||(e.setTerrain(null),e.removeSource("terrain"),e.setTerrain({source:"terrain",exaggeration:1}),e.getBounds().toArray(),e.getZoom(),he(),_())},Xe=f=>{if(!e||!w(e))return;const b=e.getCanvas();b&&(b.style.cursor=f)},O=f=>b=>f.subscribe(P=>{P&&b(P)});return{subscribe:t,init:A,isInitialized:()=>R(u),remove:()=>{!e||!w(e)||(e.remove(),e=null,n(null),a.set(null),l.set(null),h.set(null),i.set(null),m.set(null),J.set(!0),d.set(null),y.set(null),c.set(null),u.set(null),g.set(null),r=null)},addLockonMarker:I,removeLockonMarker:Q,queryRenderedFeatures:Ne,setCursor:Xe,setData:(f,b)=>{if(!e||!w(e))return;const P=e.getSource(f);P?P.setData(b):console.warn(`Source with ID ${f} does not exist.`)},setStyle:C,setFilter:k,setLayoutProperty:(f,b,P,x)=>{if(!(!e||!w(e)))try{e.getLayer(f)?e.setLayoutProperty(f,b,P,x):console.warn(`Layer with ID ${f} does not exist.`)}catch(W){console.error(`Error setting layout property for layer ${f}:`,W)}},setBearing:f=>e==null?void 0:e.setBearing(f),setPitch:f=>e==null?void 0:e.setPitch(f),setZoom:f=>e==null?void 0:e.setZoom(f),setCamera:f=>{if(!e)return;const b=e.queryTerrainElevation(f);e.setCenterClampedToGround(!1),e.setCenterElevation(b??0),e._elevationStart=e._elevationTarget},resetCamera:()=>{e&&(e.setCenterClampedToGround(!0),e.setCenterElevation(0),e._elevationStart=e._elevationTarget)},fitBounds:(f,b)=>{!e||!w(e)||e.fitBounds(f,b)},panTo:$e,panToPoi:Ze,flyTo:(f,b)=>{!e||!w(e)||e.flyTo({center:f,...b})},easeTo:f=>_e(f),focusLayer:Fe,focusFeature:He,jumpToFac:Y,terrainReload:_,toggleTerrain:ee,resetDem:Je,resetAllSourcesAndLayers:he,getLockonMarker:()=>r,getMap:()=>e,getZoom:()=>e==null?void 0:e.getZoom(),getCenter:()=>e==null?void 0:e.getCenter(),getPitch:()=>e==null?void 0:e.getPitch(),getBearing:()=>e==null?void 0:e.getBearing(),getTerrain:()=>e==null?void 0:e.getTerrain(),getLayer:f=>{if(!(!e||!w(e)))return e.getLayer(f)},getState:()=>R(o),getImage:f=>e==null?void 0:e.getImage(f),getMapBounds:te,getSpriteUrl:Ve,getCanvas:()=>e==null?void 0:e.getCanvas(),getMapContainer:K,onSetStyle:O(m),onResize:O(c),onload:O(g),onClick:O(s),onMouseover:O(a),onMouseout:O(l),onRotate:O(h),onZoom:O(i),onMooveEnd:O(y),onLoading:O(J),onInitialized:O(u),onStyleLoad:O(d),onStateChange:o.subscribe}},rn=Ar(),nn=S(!1),on=S(-1),sn=()=>window.innerWidth>wt,an=(r,e)=>{let t;if(e==="color"?t="bxs:color-fill":e==="number"?t="lsicon:number-filled":t="bxs:color-fill",!r)return t;switch(r){case"match":return"material-symbols:category-rounded";case"step":return"subway:step-1";case"linear":return"mdi:graph-bell-curve-cumulative";default:return t}};class Cr extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}function cn(r,{signal:e}={}){return new Promise((t,n)=>{const o=()=>{n(new Cr)},s=()=>{clearTimeout(a),o()};if(e!=null&&e.aborted)return o();const a=setTimeout(()=>{e==null||e.removeEventListener("abort",s),t()},r);e==null||e.addEventListener("abort",s,{once:!0})})}export{Qr as C,Kt as D,ae as T,Jr as a,nr as b,We as c,cn as d,nn as e,Dt as f,an as g,Er as h,sn as i,je as j,cr as k,Gr as l,rn as m,Bt as n,Kr as o,Hr as p,Xr as q,Vr as r,zr as s,on as t,Yr as u,X as x};
