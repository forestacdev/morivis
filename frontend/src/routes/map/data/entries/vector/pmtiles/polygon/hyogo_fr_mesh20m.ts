import { MAP_IMAGE_BASE_PATH } from '$routes/constants';
import type { VectorEntry, TileMetaData } from '$routes/map/data/types/vector/index';
import {
	FOREST_MESH_PROPERTIES,
	FOREST_MESH_POPUP_KEYS
} from '$routes/map/data/entries/vector/_properties';
import {
	FOREST_MESH_STYLE,
	TREE_SINGLE_COLOR_STYLE,
	FOREST_MESH_STEP_COLOR_STYLE_EXPRESSIONS,
	createFilteredTreeMatchColorStyleMapping
} from '$routes/map/data/entries/vector/_style';

const entry: VectorEntry<TileMetaData> = {
	id: 'hyogo_fr_mesh20m',
	type: 'vector',
	format: {
		type: 'pmtiles',
		geometryType: 'Polygon',
		url: 'https://d2g6co14qozqgp.cloudfront.net/pmtiles/fr_mesh20m_hyogo.pmtiles'
	},
	metaData: {
		name: '兵庫県 森林資源量集計メッシュ',
		attribution: '兵庫県',
		downloadUrl: 'https://www.geospatial.jp/ckan/dataset/fr_mesh20m_hyogo',
		location: '兵庫県',
		tags: ['森林', 'メッシュ'],
		minZoom: 13,
		maxZoom: 16,
		sourceLayer: 'fr_mesh20m_hyogo',
		bounds: [134.252809, 34.156129, 135.468591, 35.674667],
		xyzImageTile: { x: 57274, y: 25978, z: 16 },
		center: [134.651168, 34.897842],
		mapImage: `${MAP_IMAGE_BASE_PATH}/hyogo_fr_mesh20m.webp`
	},
	properties: {
		fields: [...FOREST_MESH_PROPERTIES.fields],
		attributeView: {
			popupKeys: [...FOREST_MESH_POPUP_KEYS],
			relations: {
				...FOREST_MESH_PROPERTIES.attributeView.relations
			},
			titles: [
				...FOREST_MESH_PROPERTIES.attributeView.titles,
				{
					conditions: [],
					template: '兵庫県の森林資源メッシュ'
				}
			]
		}
	},
	interaction: {
		clickable: true
	},
	style: {
		...FOREST_MESH_STYLE,
		colors: {
			...FOREST_MESH_STYLE.colors,
			expressions: [
				TREE_SINGLE_COLOR_STYLE,
				{
					type: 'match',
					key: '解析樹種',
					name: '樹種ごとの色分け',
					mapping: createFilteredTreeMatchColorStyleMapping([
						'スギ',
						'ヒノキ類',
						'マツ類',
						'その他N',
						'その他L',
						'タケ',
						'その他'
					]), // 'その他' を含む
					noData: {
						value: 'transparent',
						pattern: null
					}
				},
				...FOREST_MESH_STEP_COLOR_STYLE_EXPRESSIONS
			]
		},
		outline: {
			...FOREST_MESH_STYLE.outline
		},
		labels: {
			...FOREST_MESH_STYLE.labels
		},
		default: {
			...FOREST_MESH_STYLE.default
		}
	}
};

export default entry;

/**

================================================================================
属性情報
================================================================================

【JF20mID】 型: TEXT(12)
  ユニーク値数: 25,140,000, NULL数: 53/25,140,053
  サンプル値: ['05LE23000000', '05LE23000001', '05LE23000002', '05LE230000...

【解析樹種ID】 型: TEXT(2)
  ユニーク値数: 7, NULL数: 10,648,499/25,140,053
  値の分布:
    NULL: 10,648,499 (42.4%)
    11: 8,235,153 (32.8%)
    01: 2,306,443 (9.2%)
    02: 2,122,647 (8.4%)
    99: 1,166,514 (4.6%)
    03: 426,386 (1.7%)
    12: 224,172 (0.9%)
    07: 10,239 (0.0%)

【解析樹種】 型: TEXT(50)
  ユニーク値数: 7, NULL数: 10,648,499/25,140,053
  値の分布:
    NULL: 10,648,499 (42.4%)
    その他L: 8,235,153 (32.8%)
    スギ: 2,306,443 (9.2%)
    ヒノキ類: 2,122,647 (8.4%)
    その他: 1,166,514 (4.6%)
    マツ類: 426,386 (1.7%)
    タケ: 224,172 (0.9%)
    その他N: 10,239 (0.0%)

【樹種ID】 型: TEXT(5)
  ユニーク値数: 7, NULL数: 10,648,499/25,140,053
  値の分布:
    NULL: 10,648,499 (42.4%)
    5: 8,235,153 (32.8%)
    1: 2,306,443 (9.2%)
    2: 2,122,647 (8.4%)
    7: 1,166,514 (4.6%)
    3: 426,386 (1.7%)
    6: 224,172 (0.9%)
    4: 10,239 (0.0%)

【樹種】 型: TEXT(50)
  ユニーク値数: 7, NULL数: 10,648,499/25,140,053
  値の分布:
    NULL: 10,648,499 (42.4%)
    広葉樹: 8,235,153 (32.8%)
    スギ: 2,306,443 (9.2%)
    ヒノキ類: 2,122,647 (8.4%)
    その他: 1,166,514 (4.6%)
    マツ類: 426,386 (1.7%)
    タケ: 224,172 (0.9%)
    その他針葉樹: 10,239 (0.0%)

【面積_ha】 型: REAL
  ユニーク値数: 1, NULL数: 53/25,140,053
  最小: 0.04, 最大: 0.04, 平均: 0.04
  値の分布:
    0.04: 25,140,000 (100.0%)
    NULL: 53 (0.0%)

【立木本数】 型: MEDIUMINT
  ユニーク値数: 111, NULL数: 53/25,140,053
  最小: 0, 最大: 117, 平均: 4.71
  サンプル値: [0, 27, 30, 24, 22]

【立木密度】 型: MEDIUMINT
  ユニーク値数: 111, NULL数: 53/25,140,053
  最小: 0, 最大: 2925, 平均: 117.76
  サンプル値: [0, 675, 750, 600, 550]

【平均樹高】 型: REAL
  ユニーク値数: 434, NULL数: 53/25,140,053
  最小: 0.0, 最大: 48.0, 平均: 3.86
  サンプル値: [0.0, 13.8, 16.8, 20.1, 17.4]

【平均直径】 型: REAL
  ユニーク値数: 740, NULL数: 53/25,140,053
  最小: 0.0, 最大: 85.4, 平均: 5.54
  サンプル値: [0.0, 26.1, 27.9, 33.2, 30.7]

【合計材積】 型: REAL
  ユニーク値数: 64,308, NULL数: 53/25,140,053
  最小: 0.0, 最大: 160.268, 平均: 3.81
  サンプル値: [0.0, 9.674, 14.723, 19.511, 13.38]

【ha材積】 型: MEDIUMINT
  ユニーク値数: 2,234, NULL数: 53/25,140,053
  最小: 0, 最大: 4007, 平均: 95.36
  サンプル値: [0, 242, 368, 488, 334]

【収量比数】 型: REAL
  ユニーク値数: 113, NULL数: 53/25,140,053
  最小: 0.0, 最大: 1.12, 平均: 0.11
  サンプル値: [0.0, 0.4, 0.52, 0.54, 0.44]

【相対幹距比】 型: REAL
  ユニーク値数: 1,779, NULL数: 53/25,140,053
  最小: 0.0, 最大: 909.1, 平均: 3.50
  サンプル値: [0.0, 27.8, 21.8, 20.3, 24.5]

【形状比】 型: REAL
  ユニーク値数: 1,672, NULL数: 53/25,140,053
  最小: 0.0, 最大: 622.9, 平均: 13.82
  サンプル値: [0.0, 57.2, 63.0, 67.1, 58.9]

【樹冠長率】 型: MEDIUMINT
  ユニーク値数: 127, NULL数: 53/25,140,053
  最小: 0, 最大: 151, 平均: 5.76
  サンプル値: [0, 33, 34, 26, 41]

【森林計測年】 型: DATE
  ユニーク値数: 18, NULL数: 40,174/25,140,053
  値の分布:
    1899-12-30: 10,608,826 (42.2%)
    2021-05-24: 1,794,517 (7.1%)
    2020-12-18: 1,726,874 (6.9%)
    2021-05-04: 1,445,449 (5.7%)
    2021-06-21: 1,320,469 (5.3%)
    2021-04-24: 1,193,092 (4.7%)
    2021-10-15: 997,753 (4.0%)
    2022-05-07: 891,170 (3.5%)
    2022-02-09: 889,134 (3.5%)
    2022-04-28: 885,558 (3.5%)
    2022-10-21: 684,745 (2.7%)
    2020-12-02: 672,447 (2.7%)
    2021-09-28: 667,476 (2.7%)
    2022-04-07: 499,350 (2.0%)
    2021-10-02: 347,518 (1.4%)
    2019-10-09: 182,796 (0.7%)
    2020-09-08: 180,246 (0.7%)
    2019-01-01: 112,459 (0.4%)
    NULL: 40,174 (0.2%)

【森林計測法】 型: TEXT(1)
  ユニーク値数: 1, NULL数: 10,648,499/25,140,053
  値の分布:
    1: 14,491,554 (57.6%)
    NULL: 10,648,499 (42.4%)

【平均傾斜】 型: MEDIUMINT
  ユニーク値数: 73, NULL数: 53/25,140,053
  最小: 0, 最大: 72, 平均: 17.52
  サンプル値: [0, 42, 41, 38, 43]

【最大傾斜】 型: MEDIUMINT
  ユニーク値数: 90, NULL数: 53/25,140,053
  最小: 0, 最大: 89, 平均: 29.45
  サンプル値: [0, 65, 76, 79, 73]

【最小傾斜】 型: MEDIUMINT
  ユニーク値数: 52, NULL数: 53/25,140,053
  最小: 0, 最大: 57, 平均: 6.20
  サンプル値: [0, 1, 9, 7, 8]

【最頻傾斜】 型: MEDIUMINT
  ユニーク値数: 90, NULL数: 53/25,140,053
  最小: 0, 最大: 89, 平均: 16.79
  サンプル値: [0, 53, 42, 55, 54]

【県code】 型: TEXT(2)
  ユニーク値数: 1, NULL数: 4,140,672/25,140,053
  値の分布:
    28: 20,999,381 (83.5%)
    NULL: 4,140,672 (16.5%)

【市町村code】 型: TEXT(5)
  ユニーク値数: 49, NULL数: 4,140,672/25,140,053
  サンプル値: ['28586', '28585', '28209', '28222', '28227']

【f_table_catalog】 型: TEXT(256)
  ユニーク値数: 1, NULL数: 25,140,000/25,140,053
  値の分布:
    NULL: 25,140,000 (100.0%)
    : 53 (0.0%)

【f_table_schema】 型: TEXT(256)
  ユニーク値数: 1, NULL数: 25,140,000/25,140,053
  値の分布:
    NULL: 25,140,000 (100.0%)
    : 53 (0.0%)

【f_table_name】 型: TEXT(256)
  ユニーク値数: 53, NULL数: 25,140,000/25,140,053
  サンプル値: ['fr_mesh20m_05LE1_2025', 'fr_mesh20m_05LE2_2025', 'fr_mesh2...

【f_geometry_column】 型: TEXT(256)
  ユニーク値数: 1, NULL数: 25,140,000/25,140,053
  値の分布:
    NULL: 25,140,000 (100.0%)
    geom: 53 (0.0%)

【styleName】 型: TEXT(30)
  ユニーク値数: 53, NULL数: 25,140,000/25,140,053
  サンプル値: ['fr_mesh20m_05LE1_2025', 'fr_mesh20m_05LE2_2025', 'fr_mesh2...

【styleQML】 型: TEXT
  ユニーク値数: 53, NULL数: 25,140,000/25,140,053
  サンプル値: ['<!DOCTYPE qgis PUBLIC \'http://mrcc.com/qgis.dtd\' \'SYSTE...

【styleSLD】 型: TEXT
  ユニーク値数: 1, NULL数: 25,140,000/25,140,053
  値の分布:
    NULL: 25,140,000 (100.0%)
    <?xml version="1.0" encoding="UTF-8"?>
<...: 53 (0.0%)

【useAsDefault】 型: BOOLEAN
  ユニーク値数: 1, NULL数: 25,140,000/25,140,053
  値の分布:
    NULL: 25,140,000 (100.0%)
    1: 53 (0.0%)

【description】 型: TEXT
  ユニーク値数: 53, NULL数: 25,140,000/25,140,053
  サンプル値: ['水 5 7 10:40:18 2025', '水 5 7 10:41:00 2025', '水 5 7 10:41:...

【owner】 型: TEXT(30)
  ユニーク値数: 1, NULL数: 25,140,000/25,140,053
  値の分布:
    NULL: 25,140,000 (100.0%)
    : 53 (0.0%)

【ui】 型: TEXT(30)
  ユニーク値数: 0, NULL数: 25,140,053/25,140,053
  値の分布:
    NULL: 25,140,053 (100.0%)
*/
